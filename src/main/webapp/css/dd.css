var prodDCutil=window.ProdDCutil||{};prodDCutil.getPermanent_id=function(){if("undefined"==typeof DDF)return DDF.permanent_id};prodDCutil.getSourceUrl=function(){var a={_url:"",_referrer:""};"undefined"==typeof DDT?(a._referrer=encodeURIComponent(document.referrer),a._url=encodeURIComponent(document.location.href)):(a._referrer=encodeURIComponent(DDT.__referrer),a._url=encodeURIComponent(DDT.__url));return a};
prodDCutil.time=function(){var a=0;return{setServerTime:function(b){a=b;setInterval(function(){++a},1E3)},getServerTime:function(){return a}}}();
var prodDDutil=window.ProdDDutil||{};prodDDutil.encodeJson=function(a){return JSON.stringify(a)};
var prodBuyNumber=(function($,module){module.min=1;module.max=10000;module.type="";module.type_min=["p51"];module.type_max=["p102"];module.ele=$("#buy-num");module.ele_tip=$("#buy-tip");var addNode=$("#num_add"),delNode=$("#num_del");module.add=function(){var flag=module.checkBuyNumber();if(flag!=2&&flag!=3){var t=parseInt(module.ele.val(),10);module.ele.val(t+1)}module.checkBuyNumber()};module.subtract=function(){var flag=module.checkBuyNumber();if(flag!=1&&flag!=3){var t=parseInt(module.ele.val(),10);module.ele.val(t-1)}module.checkBuyNumber()};module.getBuyNumber=function(){return(module.ele.length>0)?parseInt(module.ele.val(),10):1};module.setBuyNumber=function(options){var t;if(options.hasOwnProperty("min_limit_number")){t=parseInt(options.min_limit_number,10);if(module.min<t){module.min=t}}if(options.hasOwnProperty("max_limit_number")){t=parseInt(options.max_limit_number,10);if(module.max>t){module.max=t}}if(module.min>module.max){module.min=module.max}if(("type" in options)){module.type=options.type}};module.checkBuyNumber=function(){var flag=0;var text="";var t=parseInt(module.ele.val(),10);if(isNaN(t)){t=0}if($.inArray(module.type,module.type_min)!=-1&&module.min>1){text+="此商品<b>"+module.min+"</b>件起购"}if($.inArray(module.type,module.type_max)!=-1&&module.max<10000){text+="每账户限购<b>"+module.max+"</b>件，超出限购数量以当当价为准"}else{if(module.max<10000){text+="每账户最多可购买<b>"+module.max+"</b>件"}}if(text!=""){module.ele_tip.html(text)}if(t<=module.min){flag+=1;module.ele.val(module.min);delNode.removeClass().addClass("num_del").addClass("num_disabled")}else{delNode.removeClass("num_disabled")}if(t>=module.max&&module.max<10000&&$.inArray(module.type,module.type_max)==-1){flag+=2;module.ele.val(module.max);addNode.removeClass().addClass("num_add").addClass("num_disabled")}else{addNode.removeClass("num_disabled")}return flag};function init(){module.min=1;module.max=10000;module.type="";module.ele_tip.html("")}module.bind=function(){module.checkBuyNumber();module.ele.unbind("keyup").keyup(module.checkBuyNumber);delNode.off("click").on("click",function(){module.subtract()});addNode.off("click").on("click",function(){module.add()});if(item.stock.stockType=="noStock"){addNode.addClass("num_disabled");delNode.addClass("num_disabled");addNode.off("click");delNode.off("click");module.ele.attr("disabled","disabled")}};module.init=function(){$("body").off("initBuyNumber").on("initBuyNumber",init)};return module})(jQuery,window.prodBuyNumber||{});var prodOperationButtonBox=(function($,module){var shoppingUri="//shopping.dangdang.com/shoppingcart/cart_append_new?product_ids=";var clearingInstallmentUri="//checkoutb.dangdang.com/checkout.aspx?checkout_type=13&";var clearingBaseUri="//checkoutb.dangdang.com/checkout.aspx?";var clearingOverseasUri="//checkoutb.dangdang.com/checkout.aspx?checkout_type=7&";var clearingUri="//checkoutb.dangdang.com/checkout.aspx?checkout_type=10&";var clearingPreSaleUri="//checkoutb.dangdang.com/checkout.aspx?checkout_type=9&";var clearingGiftUri="//checkoutb.dangdang.com/checkout.aspx?";var clearingEGiftUri="//checkoutb.dangdang.com/checkout.aspx?checkout_type=16&";var contractUri="//product.dangdang.com/contractphone/product.php?product_id=";var favorList="//wish.dangdang.com/wishlist/remote_addtofavorlist.aspx";var energySavingUri="//renzheng.customer.dangdang.com/renzheng.php?checkout_url=http%3A//checkoutb.dangdang.com/checkout.aspx%3F";var infoNoticeUri="http://myhome.dangdang.com/productStockoutRegistration/show";var infoNoticeHkUri="http://myhome.globaldangdang.hk/productStockoutRegistration/show";var energy=[1,2];var energy_categories=[4010620,4009636,4009637,4009638,4009643,4010649];var energy_regions=[111];var spec_shop_1=[18081];var giftCardUri="http://giftcard.dangdang.com/?cardid=";var buttonArr=["#part_buy_button","#gift_card_button","#buy_now_button","#deposit_buy_button","#installment_buy_button","#btn_buy_now","#energy_conservation","#stock_no_stock","#sign_no_stock","#pod_buy_button"];var buttonNoContainArr=["phone_buy_button"];var buttonShowArr=[];module.getAllButton=function(prod_data){var stock_type=prod_data.stock_type;if($.inArray(prod_data.shop_id,spec_shop_1)!=-1){module.addBabyButtion();return}else{if(prod_data.is_wireless>0){return}}if(prod_data.stock_status==-1){module.addShoppingButton(stock_type,shoppingUri,prod_data.stock_status)}else{if(prod_data.pre_sale.isPreSale==1){var presale_model={presale_type:~~prod_data.pre_sale.type,start_date:~~prod_data.pre_sale.startDate,end_date:~~prod_data.pre_sale.endDate,server_time:~~prod_data.server_time,rank_num:~~prod_data.pre_sale.rankNum};if(prod_data.pre_sale.type==0){if(prod_data.shop_id>0&&$.inArray(prod_data.shop_type,new Array(5,6))===-1){module.addPreSaleButton(stock_type,shoppingUri,presale_model,prod_data.shop_id,prod_data.shop_type)}else{if(stock_type==0){module.addSoldOutButton(prod_data.is_sold_out,prod_data.product_id,prod_data.server_time,prod_data.shop_id,prod_data.shop_type)}else{if(stock_type==2){module.addPreSaleButton(stock_type,shoppingUri,presale_model,prod_data.shop_id,prod_data.shop_type)
}else{hidePresaleAttr();module.addShoppingButton(stock_type,shoppingUri);module.addClearingButton(stock_type,clearingUri)}}}}else{if(prod_data.pre_sale.type>0){module.addDepositButton(stock_type,clearingPreSaleUri,presale_model,prod_data.shop_id,prod_data.shop_type,prod_data.is_sold_out,prod_data.product_id,prod_data.server_time)}}if(prod_data.is_pod==0&&prod_data.pod_id>0&&stock_type==0&&presale_model.start_date<=prodDCutil.time.getServerTime()&&$("#pod_buy_button").length>0){module.addPodButton()}}else{if(stock_type==0&&prod_data.product_type!=52){module.addSoldOutButton(prod_data.is_sold_out,prod_data.product_id,prod_data.server_time,prod_data.shop_id,prod_data.shop_type)}else{if(prod_data.product_type==51){module.addGiftShoppingButton(stock_type,giftCardUri);module.addClearingButton(stock_type,clearingGiftUri)}else{if(prod_data.product_type==52){module.addGiftShoppingButton(1,giftCardUri);module.addClearingButton(1,clearingEGiftUri)}else{if(prod_data.shop_id>0&&prod_data.shop_type==5){module.addShoppingButton(stock_type,shoppingUri);module.addClearingButton(stock_type,clearingOverseasUri)}else{if(prod_data.is_support_installment==1&&prod_data.sale_price>=~~prod_data.installment_conf.b401.amount_lower&&prod_data.sale_price<=~~prod_data.installment_conf.b401.amount_upper){module.addShoppingButton(stock_type,shoppingUri);module.addInstallmentButton(stock_type,prod_data.sale_price,prod_data.installment_conf,clearingInstallmentUri)}else{module.addShoppingButton(stock_type,shoppingUri);if(prod_data.activity_type!=88&&prod_data.activity_type!=90){module.addClearingButton(stock_type,clearingUri)}}}}}}if(prod_data.is_pod==0&&prod_data.pod_id>0&&stock_type==0&&$("#pod_buy_button").length>0){module.addPodButton()}}}if($.inArray(prod_data.energy_level,energy)>-1&&$.inArray(prod_data.category_id,energy_categories)>-1&&($.inArray(prod_data.geo.province_id,energy_regions)>-1||$.inArray(prod_data.geo.city_id,energy_regions)>-1||$.inArray(prod_data.geo.town_id,energy_regions)>-1)&&(prod_data.shop_id=="0"||prod_data.shop_type=="6")){if(stock_type>0){module.addSubsidyButton(stock_type,energySavingUri)}}return true};module.addMobileButton=function(in_stock){};function saleOutStock(productType){var s=$("#stock_no_stock");var t=(item.base.shopId>0&&$.inArray(item.base.shopType,[5,6])===-1)?$('<a href="javascript:;" class="btn btn_red btn_disabled" id="stock_no_stock">卖光了</a>'):$('<a href="javascript:;" class="btn btn_red btn_disabled" id="stock_no_stock">不再销售</a>');if(s.length>0){s.remove()}$(".buy_box_btn").prepend(t);buttonShowArr.push("#stock_no_stock")}module.addSoldOutButton=function(is_sold_out,product_id,time,shopId,shopType){var productType=item.base.template;if((shopId>0&&$.inArray(shopType,new Array(5,6))===-1)||is_sold_out>0){saleOutStock(productType)}else{var s=$("#sign_no_stock");var t=$('<a href="javascript:;" class="btn btn_b btn_b_red" id="sign_no_stock" dd_name="到货通知">到货通知</a>');t.on("click",function(){var url=~~item.base.isOverSea==1?infoNoticeHkUri:infoNoticeUri;showMsgBox("",encodeURIComponent(product_id+"&product_id="+product_id+"&source=7"),url,function(){$("body").trigger("renderAfterLogin")});return false});if(s.length>0){s.remove()}$(".buy_box_btn").prepend(t);buttonShowArr.push("#sign_no_stock")}};module.addShoppingButton=function(in_stock,go_uri,stock_status,is_sold_out,product_id,time){if(stock_status==-1){$("#part_buy_button").removeClass().addClass("btn btn_red btn_disabled").attr("dd_name","").html('<i class="cart"></i>加入购物车');buttonShowArr.push("#part_buy_button")}else{if(go_uri==null){go_uri=shoppingUri}if(in_stock>0){$("#part_buy_button").removeClass().addClass("btn btn_red").attr("dd_name","加入购物车").attr("go-uri",go_uri).html('<i class="cart"></i>加入购物车')}else{$("#part_buy_button").removeClass().addClass("btn btn_red btn_disabled").attr("dd_name","加入购物车").html('<i class="cart"></i>加入购物车')}buttonShowArr.push("#part_buy_button")}};module.addGiftShoppingButton=function(in_stock,go_uri,stock_status){if(stock_status==-1){$("#gift_card_button").removeClass().addClass("btn btn_red btn_disabled").attr("dd_name","").html('<i class="cart"></i>加入购物车');buttonShowArr.push("#gift_card_button")}else{if(go_uri==null){go_uri=giftCardUri}if(in_stock>0){$("#gift_card_button").removeClass().addClass("btn btn_red").attr("dd_name","礼品卡加入购物车").attr("go-uri",go_uri).html('<i class="cart"></i>加入购物车')}else{$("#gift_card_button").removeClass().addClass("btn btn_red btn_disabled").attr("dd_name","礼品卡加入购物车").html('<i class="cart"></i>加入购物车')}buttonShowArr.push("#gift_card_button")}};module.addClearingButton=function(in_stock,go_uri){if(go_uri==null){go_uri=clearingUri}if(in_stock>0){$("#buy_now_button").removeClass().addClass("btn btn_b btn_b_red").attr("dd_name","立即购买").attr("go-uri",go_uri).html("立即购买")}else{$("#buy_now_button").removeClass().addClass("btn btn_red btn_disabled").attr("dd_name","立即购买").attr("go-uri",go_uri).html("立即购买")}buttonShowArr.push("#buy_now_button")};module.addPreSaleButton=function(in_stock,go_uri,presale_model,shop_id,shopType){if(presale_model==null){return false
}if(shop_id>0&&$.inArray(shopType,new Array(5,6))===-1){if(presale_model.start_date>presale_model.server_time){$("#part_buy_button").removeClass().addClass("btn btn_disabled").removeAttr("dd_name").html("即将开始")}else{if(presale_model.server_time>presale_model.end_date){$("#part_buy_button").removeClass().addClass("btn btn_disabled").removeAttr("dd_name").html("结束了")}else{if(in_stock==0){$("#part_buy_button").removeClass().addClass("btn btn_disabled").removeAttr("dd_name").html("卖光了")}else{$("#part_buy_button").removeClass().addClass("btn btn_green").attr("dd_name","预订").attr("go-uri",go_uri).html('<i class="cart"></i>预&nbsp;&nbsp;订')}}}}else{if(in_stock>0){$("#part_buy_button").removeClass().addClass("btn btn_green").attr("dd_name","预订").attr("go-uri",go_uri).html('<i class="cart"></i>预&nbsp;&nbsp;订')}else{$("#part_buy_button").removeClass().addClass("btn btn_red btn_disabled").attr("dd_name","加入购物车").html('<i class="cart"></i>加入购物车')}}buttonShowArr.push("#part_buy_button")};module.addDepositButton=function(in_stock,go_uri,presale_model,shop_id,shop_type,soldOut,prod_id,server_time){$("#invite_friend_button").hide();$("#deposit_buy_button").parent().find(".tuan").hide();if(presale_model.rank_num>1&&in_stock!=0){$("#invite_friend_button").show();$("#deposit_buy_button").parent().find(".tuan").show()}if(presale_model.start_date>presale_model.server_time){$("#deposit_buy_button").removeClass().addClass("btn btn_disabled").removeAttr("dd_name").html("即将开始")}else{if(presale_model.server_time>presale_model.end_date){$("#deposit_buy_button").removeClass().addClass("btn btn_disabled").removeAttr("dd_name").html("结束了");$("#invite_friend_button").hide();$("#deposit_buy_button").parent().find(".tuan").hide()}else{if(in_stock==0){if(shop_id>0&&$.inArray(shop_type,new Array(5,6))===-1){$("#deposit_buy_button").removeClass().addClass("btn btn_disabled").removeAttr("dd_name").html("卖光了")}else{$("#deposit_buy_button").removeClass().removeAttr("dd_name").empty();module.addSoldOutButton(soldOut,prod_id,server_time,shop_id,shop_type);$("#invite_friend_button").hide();$("#deposit_buy_button").parent().find(".tuan").hide()}}else{if(presale_model.presale_type==1){$("#deposit_buy_button").removeClass().addClass("btn btn_orange").attr("dd_name","先下手为强").attr("go-uri",go_uri).html("先下手为强")}else{if(presale_model.rank_num==1){$("#deposit_buy_button").removeClass().addClass("btn btn_orange").attr("dd_name","支付定金").attr("go-uri",go_uri).html("支付定金")}else{$("#deposit_buy_button").removeClass().addClass("btn btn_orange").attr("dd_name","支付定金").attr("go-uri",go_uri).html("支付定金")}}}}}$("#ebook_buy_button").hide();buttonShowArr.push("#deposit_buy_button");if($("#deposit_buy_button").hasClass("btn_disabled")){$(".down_payment .step01").removeClass("step_hover")}else{$(".down_payment .step01").addClass("step_hover")}};module.addFavorButton=function(in_status,go_uri){if(in_status==0&&$("#btn_buy_now").length>0){$("#btn_buy_now").attr("go-uri",go_uri);buttonShowArr.push("#btn_buy_now")}};module.addSubsidyButton=function(in_status,go_uri){if(in_status>0&&$("#energy_conservation").length>0){var block_subsidy;$("#energy_conservation").attr("go-uri",go_uri);$(".buy_box_btn #energy_conservation").hover(function(){var $block=$(this);block_subsidy=setTimeout(function(){$block.addClass("btn_pop_hover")},300)},function(){$(this).removeClass("btn_pop_hover");clearTimeout(block_subsidy)});buttonShowArr.push("#energy_conservation")}};module.addInstallmentButton=function(in_status,product_price,installment_conf,go_uri){if(in_status>0&&$("#installment_buy_button").length>0){var installment_tpl='<li>                    <div class="title">银行</div>                    <div class="fei row01">${bank_name}</div>                  </li>                  {@each list as item,index}                  <li>                    <div class="title">${item.nper}期</div>                    <div class="fei"><b>￥${item.price}</b>X${item.nper}<span>手续费${item.rule}</span></div>                  </li>                  {@/each}                ';var data={};data.bank_name=installment_conf.b401.bank_name;data.list=[];for(var i=0;i<installment_conf.b401.nper.length;i++){var obj={};obj.price=(product_price>0)?Math.round(100*product_price/installment_conf.b401.nper[i].number)/100:0;obj.nper=installment_conf.b401.nper[i].number;obj.rule=(installment_conf.b401.nper[i].rule*100)+"%";data.list.push(obj)}$("#installment_buy_button ul").html(juicer(installment_tpl,data));var block_installment;$("#installment_buy_button").attr("go-uri",go_uri);$(".buy_box_btn #installment_buy_button").hover(function(){var $block=$(this);block_installment=setTimeout(function(){$block.addClass("btn_pop_hover")},300)},function(){$(this).removeClass("btn_pop_hover");clearTimeout(block_installment)});buttonShowArr.push("#installment_buy_button")}};module.addEbookButton=function(go_uri){};module.addBabyButtion=function(){buttonShowArr.push("#baby_buy_button")};module.addPodButton=function(){buttonShowArr.push("#pod_buy_button")
};module.bind=function(prod_data){buttonShowArr=[];module.getAllButton(prod_data);dragonTacticButton.bind();$($.grep(buttonArr,function(n){return $.inArray(n,buttonShowArr)==-1},false).join(",")).hide();$(buttonShowArr.join(",")).show();if($.inArray($(buttonShowArr[0]).attr("id"),buttonNoContainArr)==-1){var t=$("#tab_pannel_btn");var o=$("#buyarea_tab");if(t.length>0){t.remove()}o.prepend($(buttonShowArr[0]).clone().removeAttr("id").attr("id","tab_pannel_btn").attr("ddt-expose","on").attr("ddt-src",$(buttonShowArr[0]).attr("ddt-src").replace(/1/,"2")).on("click",function(){$(buttonShowArr[0]).click()}))}};function hidePresaleAttr(){$("#presale-title").hide();$("#presale-rule").hide()}return module})(jQuery,window.prodOperationButtonBox||{});var dragonTacticButton=(function($,module){var btnArrMaps=[{id:"#part_buy_button.btn_red",text:"加入购物车",ddtSrc:"addChart1"},{id:"#part_buy_button.btn_red btn_disabled",text:"加入购物车",ddtSrc:"addChartGrey1"},{id:"#gift_card_button.btn_red",text:"加入购物车",ddtSrc:"giftCard1"},{id:"#gift_card_button.btn_red btn_disabled",text:"加入购物车",ddtSrc:"giftCardGrey1"},{id:"#part_buy_button.btn_green",text:"预订",ddtSrc:"presaleButton1"},{id:"#part_buy_button.btn_disabled",text:"即将开始",ddtSrc:"beforeSale1"},{id:"#part_buy_button.btn_disabled",text:"结束了",ddtSrc:"overSale1"},{id:"#part_buy_button.btn_disabled",text:"卖光了",ddtSrc:"soldOutPresale1"},{id:"#buy_now_button.btn_b_red",text:"立即购买",ddtSrc:"buyNow1"},{id:"#buy_now_button.btn_red btn_disabled",text:"立即购买",ddtSrc:"buyNowGrey1"},{id:"#deposit_buy_button.btn_orange",text:"先下手为强",ddtSrc:"depositPayAll1"},{id:"#deposit_buy_button.btn_orange",text:"支付定金",ddtSrc:"depositPayPart1"},{id:"#deposit_buy_button.btn_orange",text:"支付定金",ddtSrc:"depositGroup1"},{id:"#deposit_buy_button.btn_disabled",text:"即将开始",ddtSrc:"beforeDeposit1"},{id:"#deposit_buy_button.btn_disabled",text:"结束了",ddtSrc:"overDeposit1"},{id:"#deposit_buy_button.btn_disabled",text:"卖光了",ddtSrc:"soldOutDeposit1"},{id:"#installment_buy_button_a.btn_blue",text:"分期付款",ddtSrc:"installment1"},{id:"#btn_buy_now.btn_b_red",text:"收藏商品",ddtSrc:"productCollect1"},{id:"#energy_conservation_a.btn_green02",text:"参加节能补贴",ddtSrc:"energy1"},{id:"#stock_no_stock.btn_disabled",text:"卖光了",ddtSrc:"soldOut1"},{id:"#sign_no_stock.btn_b_red",text:"到货通知",ddtSrc:"sign1"},{id:"#pod_buy_button.btn_red",text:"单印一本",ddtSrc:"podBuy1"},{id:"#baby_buy_button.btn_red03",text:"定制",ddtSrc:"babyBuy1"}];module.bind=function(){var buyBox=$(".buy_box_btn");for(var i=0;i<btnArrMaps.length;i++){if(buyBox.find(btnArrMaps[i]["id"])!=undefined){var text=$(btnArrMaps[i]["id"]).text().replace(/\s/ig,"").replace("  ","");$(btnArrMaps[i]["id"]).removeAttr("ddt-src").attr("ddt-src","");if(btnArrMaps[i]["text"]==text){$(btnArrMaps[i]["id"]).removeAttr("ddt-src").attr("ddt-src",btnArrMaps[i]["ddtSrc"]).attr("ddt-expose","on")}}}};return module})(jQuery,window.dragonTacticButton||{});var prodOperation=(function($,module){var getShoppingParam=function(data){var tmp_promo_conf=[3,28,229];var tmp_promo=[];var promo_list_node=$("#promo-list");var product_obj={"product":[],"moduleType":"","promotion":{},"buttonType":$("#part_buy_button").hasClass("btn_green")?"3":"1"};var is_show_lists_pop=false;for(var i=0;i<tmp_promo_conf.length;i++){var t=promo_list_node.find("div[data-promotype="+tmp_promo_conf[i]+"]");if(t.length>0&&t.data("select-pid")!=undefined&&t.data("select-prd-price")!=undefined){var is_spu=t.find("li[data-pid='"+t.data("select-pid")+"']").data("is-spu");if(is_spu){is_show_lists_pop=true}if(tmp_promo_conf[i]!=229){product_obj.moduleType=tmp_promo_conf[i]}product_obj.product.push({"productId":t.data("select-pid"),"productCount":1,"selectProductId":"","isLocal":0,"promotion":{"promoPrice":t.data("select-prd-price"),"promoId":t.data("promoid")+"","promoType":tmp_promo_conf[i]}});var promo={promotionId:$.trim(t.attr("data-promoid")),gift:[{"giftId":$.trim(t.data("select-pid")),"giftCount":1}]};tmp_promo.push(promo)}}if(is_show_lists_pop){var local_product={"productId":item.base.productId,"productCount":prodBuyNumber.getBuyNumber(),"selectProductId":item.base.productId,"isLocal":1};product_obj.product.unshift(local_product);showListsPop(product_obj);return false}var require_path=prodDCutil.getSourceUrl();var param_json={};param_json.product=[{"productId":data.product_id,"productCount":prodBuyNumber.getBuyNumber(),"promotion":tmp_promo}];param_json.referer=require_path._url;param_json.prev_referer=require_path._referrer;return encodeURIComponent(prodDDutil.encodeJson(param_json))};var getClearingParam=function(prod_data){var tmp_param={product_ids:"",gift_id:"",exchange_id:"",exchange_price:"",addmoney_id:"",addmoney_price:"",referer:"",prev_referer:""};if(typeof prod_data.product_id!="undefined"){tmp_param.product_ids=prod_data.product_id+"."+prodBuyNumber.getBuyNumber()}var tmp_promo_conf=[3,28,229];var tmp_promo=[];var promo_list_node=$("#promo-list");var product_obj={"product":[],"moduleType":"","promotion":{},"buttonType":"2"};var is_show_lists_pop=false;
for(var i=0;i<tmp_promo_conf.length;i++){var t=promo_list_node.find("div[data-promotype="+tmp_promo_conf[i]+"]");if(t.length>0&&t.data("select-pid")!=undefined&&t.data("select-prd-price")!=undefined){var is_spu=t.find("li[data-pid='"+t.data("select-pid")+"']").data("is-spu");if(is_spu){is_show_lists_pop=true}if(tmp_promo_conf[i]!=229){product_obj.moduleType=tmp_promo_conf[i]}product_obj.product.push({"productId":t.data("select-pid"),"productCount":1,"selectProductId":"","isLocal":0,"promotion":{"promoPrice":t.data("select-prd-price"),"promoId":t.data("promoid")+"","promoType":tmp_promo_conf[i]}});if(tmp_promo_conf[i]==28){tmp_param.exchange_id=$.trim(t.data("select-pid"));tmp_param.exchange_price=$.trim(t.data("select-prd-price"))}else{if(tmp_promo_conf[i]==3){tmp_param.gift_id=$.trim(t.data("select-pid"))}else{if(tmp_promo_conf[i]==229){tmp_param.addmoney_id=$.trim(t.data("select-pid"));tmp_param.addmoney_price=$.trim(t.data("select-prd-price"))}}}}}if(is_show_lists_pop){var local_product={"productId":item.base.productId,"productCount":prodBuyNumber.getBuyNumber(),"selectProductId":item.base.productId,"isLocal":1};product_obj.product.unshift(local_product);showListsPop(product_obj);return false}var require_path=prodDCutil.getSourceUrl();tmp_param.referer=require_path._url;tmp_param.prev_referer=require_path._referrer;return $.param(tmp_param)};function setCookie(cname,cvalue,exdays){var d=new Date();d.setTime(d.getTime()+(exdays*24*60*60*1000));var expires="expires="+d.toGMTString();document.cookie=cname+"="+cvalue+"; "+expires}function getCookie(cname){var name=cname+"=";var ca=document.cookie.split(";");for(var i=0;i<ca.length;i++){var c=ca[i].trim();if(c.indexOf(name)==0){return c.substring(name.length,c.length)}}return""}var buildButtonHandle=function(e){var data=e.data;var thisObj=e.target||e.srcElement;if($(thisObj).hasClass("btn_disabled")){return false}if($(thisObj).attr("id")=="part_buy_button"){var iscartshop=getCookie("is_button_cartshop");if(iscartshop!=1){$("#cartshop-pop").show();$("#pc_cartshop_go").show();$("#pc_bugnow_go").hide();setCookie("is_button_cartshop",1,7);return}var _param=getShoppingParam(data);if(_param){window.open($(thisObj).attr("go-uri")+_param,"_self")}}else{if($(thisObj).attr("id")=="pc_cartshop_go"){var _param=getShoppingParam(data);if(_param){window.open($(thisObj).attr("go-uri")+_param,"_self")}}else{if($(thisObj).attr("id")=="pc_bugnow_go"){showMsgBox($(thisObj).attr("id"),"","",function(){var _param=getClearingParam(data);if(_param){window.location.href=$(thisObj).attr("go-uri")+_param}return true})}else{if($(thisObj).attr("id")=="buy_now_button"){var isbugnow=getCookie("is_button_bugnow");if(isbugnow!=1){$("#cartshop-pop").show();$("#pc_cartshop_go").hide();$("#pc_bugnow_go").show();setCookie("is_button_bugnow",1,7);return}showMsgBox($(thisObj).attr("id"),"","",function(){var _param=getClearingParam(data);if(_param){window.location.href=$(thisObj).attr("go-uri")+_param}return true})}else{if($(thisObj).attr("id")=="deposit_buy_button"){var go_uri=$(thisObj).attr("go-uri")+"product_ids="+data.product_id+"."+prodBuyNumber.getBuyNumber();window.open(go_uri,"_self")}else{if($(thisObj).attr("id")=="phone_buy_button"){$("#phone_buy_button").prev().children("img").attr("src","/?r=callback/mobile-qr&productId="+data.product_id);$("#phone_buy_button").parent().toggleClass("btn_pop_click");return false}else{if($(thisObj).attr("id")=="installment_buy_button_a"){var go_uri=$(thisObj).parent().attr("go-uri")+"product_ids="+data.product_id+"."+prodBuyNumber.getBuyNumber();window.open(go_uri,"_self")}else{if($(thisObj).attr("id")=="btn_buy_now"){return module.addFavor("btn_buy_now",data.product_id,$(thisObj).attr("go-uri"))}else{if($(thisObj).attr("id")=="ebook_buy_button"){return true}else{if($(thisObj).attr("id")=="energy_conservation_a"){var tmp_param={"checkout_type":8,"product_ids":data.product_id};var go_uri=$(thisObj).parent().attr("go-uri")+encodeURIComponent($.param(tmp_param))+"&checkout_ddname=%u53BB%u7ED3%u7B97";window.open(go_uri,"_self")}else{if($(thisObj).attr("id")=="baby_buy_button"){var go_uri=$(thisObj).attr("go-uri");showMsgBox($(thisObj).attr("id"),"","",function(){window.location.href=go_uri});return true}else{if($(thisObj).attr("id")=="gift_card_button"){var go_uri=$(thisObj).attr("go-uri")+data.product_id+"&count="+prodBuyNumber.getBuyNumber()+"#gift_card";window.open(go_uri,"_self")}else{return true}}}}}}}}}}}}return true};module.addFavor=function(obj_id,product_id,go_uri){showMsgBox(obj_id,product_id,go_uri,function(){$("body").trigger("renderAfterLogin")});return false};module.bind=function(data){$(".buy_box_btn").off("click").on("click",data,buildButtonHandle)};function init(){var prod_data={};prod_data.server_time=prodDCutil.time.getServerTime();prod_data.activity_type=item.hasOwnProperty("activity")?~~item.activity.type:0;prod_data.product_id=~~item.base.productId;prod_data.category_id=~~item.base.categoryId;prod_data.energy_level=~~item.base.energyLevel;
prod_data.is_catalog=~~item.base.isCatalog;prod_data.is_wireless=~~item.base.isWireless;prod_data.is_sold_out=~~item.base.isSoldOut;prod_data.product_type=~~item.base.productType;prod_data.shop_type=~~item.base.shopType;prod_data.shop_id=~~item.base.shopId;prod_data.ebook_product_id=~~item.base.EBookId;prod_data.stock_status=~~item.stock.stockStatus;prod_data.stock_type=geo.stockInfo().stockType.toLowerCase();prod_data.pre_sale={};prod_data.pre_sale.startDate=~~item.preSale.startDate;prod_data.pre_sale.endDate=~~item.preSale.endDate;prod_data.pre_sale.type=~~item.preSale.type;prod_data.pre_sale.isPreSale=~~item.preSale.isPreSale;prod_data.pre_sale.rankNum=~~item.preSale.rankNum;prod_data.sale_price=price.getFinalPrice();prod_data.is_support_installment=~~item.price.isSupportInstallment;prod_data.is_pod=~~item.base.isPod;prod_data.pod_id=~~item.base.podId;if(prod_data.is_support_installment==1){prod_data.installment_conf=item.attachInfo.installmentInfo}switch(prod_data.stock_type){case"realstock":default:prod_data.stock_type=1;break;case"prestock":case"presale":prod_data.stock_type=2;break;case"nostock":prod_data.stock_type=0;break}var tmp=geo.getGeoInfo();prod_data.geo={province_id:~~tmp.province.id,city_id:~~tmp.city.id,town_id:~~tmp.town.id};prodBuyNumber.bind();prodOperationButtonBox.bind(prod_data);module.bind(prod_data)}module.init=function(){$("body").off("initOperation").on("initOperation",init)};return module})(jQuery,window.prodOperation||{});var mainImg=(function($){var exports={};var largePicDiv=$("#largePicDiv");var mainImgModalMsgBox=$("#modalMainImg");var collectNode=$("#collect_left");var iconTplTable=[];var collectUriHk="http://myhome.globaldangdang.hk/addFavoritepop";var collectUri="http://myhome.dangdang.com/addFavoritepop";function requires(){return{productId:item.base.productId,productName:item.base.productName,isPublish:item.base.template=="publish",originalPrice:item.price==undefined?-1:item.price.originalPrice,isOversea:item.base.isOverSea}}function setModalBind(){$("#masksClose").click(function(){$(mainImgModalMsgBox).hide()});var ulId=$("#mask-small-list-slider");var liLength=parseInt(ulId.children().length%6);if(0!==liLength){liLength=6-liLength}for(var times=0;times<liLength;times++){ulId.append("<li></li>")}var speed=200;if(ulId.find(">li").length<=6){$("#mask-down, #mask-up").hide();speed=0}var currentIdx=0;var goToEnd=false;$("#mask-small-list").jCarouselLite({btnNext:"#mask-down",btnPrev:"#mask-up",visible:6,scroll:6,vertical:true,speed:speed,afterEnd:function(items){var len=items.length;$(ulId).find(">li").removeAttr("idx");times=0;$.each($(items),function(idx,item){$(item).css({opacity:0.5}).attr("idx",times++)});if(!goToEnd){$(items[0]).find("a").trigger("click");currentIdx=0}else{var usefulLen=$(ulId).find("> li:has(a)[idx]").length-1;$(items[usefulLen]).find("a").trigger("click");currentIdx=usefulLen;goToEnd=false}}});$(ulId).find(">li").css({opacity:0.5});for(var i=6;i<12;i++){$(ulId.find("li")[i]).attr("idx",i-6)}$(ulId.find("li")[6]).css({opacity:1});ulId.find("> li > a").on({click:function(){$("#modalBigImg").prop("src",$(this).data("imghref"));ulId.find("> li").css({opacity:0.5});$(this).parent().removeClass().css({opacity:1});currentIdx=parseInt($(this).parent().attr("idx"))},mouseover:function(){$(this).trigger("click")}});$("#mask-left").on("click",function(){if(currentIdx==0){$("#mask-up").trigger("click");goToEnd=true}else{currentIdx=currentIdx-1;$(ulId).find("> li[idx="+currentIdx+"] > a").trigger("click")}});$("#mask-right").on("click",function(){var len=$(ulId).find("> li:has(a)[idx]").length-1;if(currentIdx==len){$("#mask-down").trigger("click")}else{currentIdx=currentIdx+1;$(ulId).find("> li[idx="+currentIdx+"] > a").trigger("click")}})}function setShareBind(){function getShareCallback(productId,productName,price,originalPrice,promotionType,priceTitle){$.getJSON(window.localUrl,{r:"callback/get-share-data",productId:productId,productName:encodeURI(productName),originalPrice:originalPrice,price:price,promotionType:promotionType,priceTitle:encodeURI(priceTitle)},function(data){if(data.errMsg===""){data=data.data}else{return}$.each($("#share-url").find("> li"),function(idx,item){if($(item).data("dstweb") in data){var attr=$(item).data("dstweb");$(item).find(">a").attr("onclick",data[attr]);$(item).find(">a").attr("href",data[attr])}});$.each($("#deposit-share-url").find("a"),function(idx,item){if($(item).data("dstweb") in data){var attr=$(item).data("dstweb");$(this).attr("onclick",data[attr]);$(this).attr("href",data[attr])}})})}var hasCallback=false;$("#share_div, #deposit-share").hover(function(){if(this.id=="share_div"){$("#share-url").show()}else{if(this.id=="deposit-share"){$(this).addClass("btn_pop_hover")}}if(hasCallback==false){var params=requires();var icon=$("#main-image-icon");var promoType=icon.data("promotype");getShareCallback(params.productId,params.productName,price.getFinalPrice,params.originalPrice,promoType,"当当价");hasCallback=true}},function(){if(this.id=="share_div"){$("#share-url").hide()}else{if(this.id=="deposit-share"){$(this).removeClass("btn_pop_hover")}}})}function setMainImgSlide(){var ulId=$("#main-img-slider");var imgNum=5;var liLength=parseInt(ulId.children().length%imgNum);if(ulId.find(">li").length<=imgNum){$("#next_slide, #pre_slide").css({display:"none"})}if(0!==liLength){liLength=imgNum-liLength}for(var i=0;i<liLength;i++){ulId.append("<li></li>")}$("#main-img-slide").jCarouselLite({btnNext:"#next_slide",btnPrev:"#pre_slide",visible:imgNum,scroll:imgNum});ulId.find("> li > a").on("click mouseenter",function(){$("#largePic").prop("src",$(this).data("imghref"));$("#detailPicDiv").find("img").prop("src",$(this).data("imghref").replace(/(_w|_k)/,"_u"));$(ulId).find(">li").removeClass("on");$(this).parent().addClass("on")})}function setCollectBtn(){requestCollect();collectNode.click(function(){var collectUrl=requires().isOversea==="1"?collectUriHk:collectUri;showMsgBox("",encodeURIComponent(requires().productId+"&platform=1"),collectUrl,function(){$("body").trigger("renderAfterLogin");setTimeout(requestCollect,1000)});return false})}function requestCollect(){var pid=requires().productId;var collectData={r:"callback/get-collect-status",productId:pid};if(collectNode.hasClass("btn_scsp_on")){return}else{$.ajax({type:"GET",url:window.localUrl,data:collectData,success:function(response){if(response.errMsg!=""||response.data.length==0||response.data.status!=2000){return}if(response.data.data[pid].is_favorite!=0){collectNode.addClass("btn_scsp_on");
        collectNode.html(collectNode.html().replace(/收藏商品/,"已收藏"))}}})}}exports.init=function(){largePicDiv.mouseenter(function(){if(largePicDiv.data("isTag")!=true){$("#moveMask, #detailPicDiv").show()}}).mouseleave(function(){$("#moveMask, #detailPicDiv").hide()}).mousemove(function(e){var oEvent=e||event;var largePic=$("#largePic");var move=$("#moveMask");var detailPic=$("#detailPic");var moveWidth=$(move).width(),moveHeight=$(move).height();var imgWidth=$(largePic).width();var imgHeight=$(largePic).height();var pointOffsetX=oEvent.pageX-$(largePic).offset().left;var pointOffsetY=oEvent.pageY-$(largePic).offset().top;var offsetXMin=moveWidth/2;var offsetXMax=imgWidth-moveWidth/2;var offsetYMin=moveHeight/2;var offsetYMax=imgHeight-moveHeight/2;var moveLeft,moveTop;if(pointOffsetX<offsetXMin){moveLeft=0}else{if(pointOffsetX>offsetXMax){moveLeft=offsetXMax-offsetXMin}else{moveLeft=pointOffsetX-offsetXMin}}if(pointOffsetY<offsetYMin){moveTop=0}else{if(pointOffsetY>offsetYMax){moveTop=offsetYMax-offsetYMin}else{moveTop=pointOffsetY-offsetYMin}}$(move).css({left:moveLeft+"px",top:moveTop+"px"});$(detailPic).css({left:parseInt($(move).css("left"))*(-800/imgWidth)+"px",top:parseInt($(move).css("top"))*(-800/imgHeight)+"px",position:"absolute"})}).click(function(event){if($(event.target).prop("class")=="icon_online"){return}$(mainImgModalMsgBox).show()});largePicDiv.find(".icon_online").mouseover(function(){$("#moveMask, #detailPicDiv").hide();largePicDiv.data("isTag",true)}).mouseleave(function(){largePicDiv.data("isTag",false);$("#moveMask, #detailPicDiv").show()});setMainImgSlide();setModalBind();setShareBind();setCollectBtn();mainImg.icon.setLabel();$("body").on("requestCollect",requestCollect).on("updateIcon",mainImg.icon.setLabel)};exports.icon={set:function(iconInfo,type,promoType){var tpl;var data={url:iconInfo.src,discount:price.getFinalDiscount()};if(0===iconTplTable.length){tpl=$("#promo-icon-tpl").find(">script");$.each(tpl,function(idx,item){var type=$(item).data("type");iconTplTable[type]=$(item)})}var icon_node=$("#main-image-icon");if(type=="flash"){icon_node.html(juicer(iconTplTable["flash"].html(),data))}else{icon_node.attr("style",juicer(iconTplTable["ordinary"].html(),data))}icon_node.data("type",type);if(promoType!=undefined){icon_node.data("promotype",promoType)}},unset:function(){var icon_node=$("#main-image-icon");icon_node.html("");icon_node.attr("style","");icon_node.data("promotype","-1")},getIconType:function(){var type=icon_node.data("type",type);return undefined==type?"":type},setLabel:function(){$("#icon_label").hide();$("#main_img_lable").hide();var iconInfo=item.base.icon;if(typeof(iconInfo)=="undefined"||iconInfo.length==0){return}$("#icon_label img").attr("src","/images/sale_picture.png");$("#icon_label p").html("");if(typeof(iconInfo.label_src)!="undefined"&&iconInfo.label_src!=""){$("#icon_label").show().find("img").attr("src",iconInfo.label_src)}else{if(typeof(iconInfo.label_word)!="undefined"&&iconInfo.label_word!=""){$("#icon_label img").attr("src","/images/sale_picture.png");$("#icon_label p").html(iconInfo.label_word);$("#icon_label").show()}}if(typeof(iconInfo.atmosphere_image)!="undefined"&&iconInfo.atmosphere_image!=""){$("#main_img_lable").attr("src",iconInfo.atmosphere_image);$("#main_img_lable").show()}else{$("#main_img_lable").hide()}}};return exports})(jQuery);var Cookie={Get:function(d){for(var c=document.cookie.split("; "),a,b=0;b<c.length;b++)if(a=c[b].split("="),a[0]===d)return unescape(a[1])}};
var freight=function(e){function h(){return{shopId:item.base.shopId,templateId:item.base.templateId}}function t(a,c,h){function m(a,g){e.getJSON(window.localUrl,{r:"callback/get-geography",areaId:k[d[b-1]].id},function(b){if(""==b.errMsg){var d="",p;for(p in b.data.geography)d+='<option data-gid="'+p.substr(1)+'">'+b.data.geography[p]+"</option>";e(f.find("select")[a-1]).html(d).val(g)}})}function q(){for(b=1;b<d.length;b++)if(-1==k[d[b]].id)return k[d[b-1]].id;return k.district.id}var k=e.extend(!0,
{},a),d=["country","province","city","district"],b,l;for(b=1;b<d.length;b++)-1==a[d[b]].id?e(f.find("select")[b-1]).html("<option id='-1'>请选择</option>"):(l=a[d[b]].name,m(b,l));n(c,q(),h,2);this.setBind=function(){f.find("select").change(function(){var a=e(this).find("option:selected"),g=e(this).index(),c=d[g];if("-1"!=a.data("gid")){k[c]={id:a.data("gid"),name:a.text()};for(b=g+1;b<d.length;b++)k[d[b]].id=-1;for(b=g+1;b<d.length-1;b++)e(f.find("select")[b]).html("<option>请选择</option>");2>=g?e.getJSON(window.localUrl,
{r:"callback/get-geography",areaId:q()},function(b){if(""==b.errMsg&&0!=b.data.geography.length){var a="",d=0,c;for(c in b.data.geography)a+='<option data-gid="'+c.substr(1)+'">'+b.data.geography[c]+"</option>",d+=1;1==d?(e(f.find("select")[g]).html(a),e(f.find("select")[g]).trigger("change")):(a='<option data-gid="-1">请选择</option>'+a,e(f.find("select")[g]).html(a))}}):e(f.find("select")[g]).val(k[c].name)}});f.find(".area > a").unbind().bind("click",function(){n(c,q(),h,2)})}}var c={},a=e("#freight"),
f=e("#shop-freight"),r=e("#special-freight"),l={165:"<li>部分地区仅支持EMS，不免邮</li><li>运费为订单总金额的40%，最低20元</li>","default":""},n=function(c,h,n,m){0==c?-1!=e.inArray(~~geo.getGeoInfo().province.id,[171,172,173])?(a.hide(),r.show()):(c=geo.getGeoInfo().province.id,c in l?a.find(">ul").html(l[c]):a.find(">ul").html(l["default"]),a.show(),r.hide()):("1"==m?a.html(""):f.find("ul").html(""),e.getJSON(window.localUrl,{r:"/callback/shipping",shopId:c,areaId:h,templateId:n,type:m},function(c){""===c.errMsg&&(1==
m?a.html(c.data):f.find("ul").html(c.data))}))};c.init=function(){0==h().shopId?(l["default"]=a.find(">ul").html(),a.hover(function(){0<a.find(">ul").length&&a.find(">ul").show()},function(){0<a.find(">ul").length&&a.find(">ul").hide()})):a.click(function(){(new t(geo.getGeoInfo(),h().shopId,h().templateId)).setBind();f.show();f.find(".close").click(function(){f.hide()})})};c.set=n;c.clear=function(){0<h().shopId&&a.text("")};c.setNoSupport=function(){a.text("不支持配送")};c.show=function(){};return c}(jQuery);
var shop=(function($){function requires(){return{productId:item.base.productId,shopId:item.base.shopId,ddShopId:item.base.ddShopId,isGiftPackaging:item.base.isGiftPackaging,isSupportReturnPolicy:item.base.isSupportReturnPolicy,isPresent:item.base.isPresent,categoryPath:item.base.categoryPath,isPod:item.base.isPod,productType:item.base.productType}}var exports={};function showZSShopInfo(shopScore){$("#shop-info").html(shopScore);$("#shop-score-jt, #shop-score-pop").hover(function(){$(this).addClass("score_hover");$(this).siblings("#shop-score-pop").show()},function(){$(this).removeClass("score_hover");$(this).siblings("#shop-score-pop").hide()})}function showShopService(shopServiceHtml){function crackShopService(){var categoryIds=[];var params=requires();if(params.shopId>0){return}$.each($("#detail-category-path").find("a"),function(idx,item){categoryIds.push($(item).data("category-id"))});if(notSupportLpk(categoryIds)){$("#shop-service").find(".J-lpk").removeClass().addClass("zclpk2 other").find("a").text("不支持礼品卡")}function notSupportLpk(categoryCollection){var specialCategoryIds=[4010415];for(var i=0;i<specialCategoryIds.length;i++){if(-1!=$.inArray(specialCategoryIds[i],categoryCollection)){return true}}return false}}var shopService=$("#shop-service");shopService.html(shopServiceHtml).show();$.each(shopService.find(">li"),function(idx,item){$(item).hover(function(){$(this).toggleClass("pic_hover")})});crackShopService()}function shopCollectBtnBind(){var shopCollectBtn=$("#shop_collect_btn");if(shopCollectBtn.length==0){return}var shopCollectPopNode=$("#shop_collect");var popWindow=shopCollectPopNode.find(".J-pop-window");var shopMsg=shopCollectPopNode.find(".J-msg");var IconNode=shopCollectPopNode.find(".J-icon");var shopCollectCheck=shopCollectPopNode.find("script.J-shop-collect-check");shopCollectBtn.off().click(function(){showMsgBox("shop_collect_btn","","",function(){$("body").trigger("renderAfterLogin");var params=requires();var shopId=params.shopId;var ddShopId=params.ddShopId==undefined?0:params.ddShopId;var timestamp=new Date().getTime();$.getJSON(window.localUrl,{r:"callback/shop-collect",shopId:shopId,ddShopId:ddShopId,timestamp:new Date().getTime()},function(response){if(response.errMsg!=""){shopMsg.text("店铺收藏失败");IconNode.removeClass().addClass("icon icon_w");shopCollectCheck.hide()}switch(response.data){case"1":shopMsg.text("店铺收藏成功");shopMsg.append(shopCollectCheck.html());IconNode.removeClass().addClass("icon");break;case"2":shopMsg.text("您已收藏该店铺");shopMsg.append(shopCollectCheck.html());IconNode.removeClass().addClass("icon icon_w");break}shopCollectPopNode.show();var width=popWindow.width();var wWidth=$(window).width();var height=popWindow.height();var wHeight=$(window).height();var left=(wWidth-width)/2;var top=(wHeight-height)/2;popWindow.css("left",left).css("top",top).show()})})});shopCollectPopNode.find(".J-confirm, .J-close").off().click(function(){shopCollectPopNode.hide()})}function getSpuInfo(){var spuNode=$("#sellers_list");var params=requires();var spuUri="//spu.dangdang.com";if(spuNode.length==0){return}$.getJSON(window.localUrl,{r:"callback/spu-prod",productId:params.productId,shopId:params.shopId},function(response){if(response.errMsg!=""||response.data==""){spuNode.hide();return}response.data.productId=params.productId;response.data.shopId=params.shopId;if(response.data.itemInfo.length>0){spuNode.html(juicer($("#sellers_list-tpl").html(),response.data))}})}function setData(){$.getJSON(window.localUrl,{r:"callback/score-service",productId:requires().productId,shopId:requires().shopId,ddShopId:requires().ddShopId,isGiftPackaging:requires().isGiftPackaging,isSupportReturnPolicy:requires().isSupportReturnPolicy,categoryPath:requires().categoryPath,isPod:requires().isPod,productType:requires().productType},function(response){if(response.errMsg!=""){return}var data=response.data;if(data.hasOwnProperty("shopScore")){showZSShopInfo(data.shopScore)}if(data.hasOwnProperty("shopService")){showShopService(data.shopService)}});!isWidth&&($("#shop_btn").click(function(){$("#service-more").toggleClass("service_more_hover")}));shopCollectBtnBind()}exports.init=function(){if(1===~~requires().isPresent){return}setData();getSpuInfo()};return exports})(jQuery);var price=(function($){var exports={};var ddPrice=$("#dd-price");var ddDiscount=$("#dd-zhe");var finalPrice=-1;var isPromoPrice=false;var ordinaryPromoPrice=undefined;var finalDiscount=-1;var vipInfo;var countDownSh;var isDepositPreSale=false;var isOrdinaryPreSale=false;function require(){var item=window.item;return{price:item.price,pintuan:item.pintuan,productId:item.base.productId,shopId:item.base.shopId,eBookId:item.base.eBookId,preSale:item.preSale,isPresent:item.base.isPresent,isVirtualProduct:item.base.isVirtualProduct,isPod:item.base.isPod,podId:item.base.podId,shopType:item.base.shopType,categoryPath:item.base.categoryPath,productName:item.base.productName}}function getFinalPrice(){if(-1===finalPrice){return require().price.salePrice}return parseFloat(finalPrice)}function setCountDown(options){if(!("limit" in options)){options.limit=true}var durationTimeNode=$("#duration-time");durationTimeNode.parent().hide();if(!("style" in options)){durationTimeNode.parent().removeClass("price_time_dj")}else{durationTimeNode.parent().addClass("price_time_dj")}if("promotion_more_url" in options){if(options.activity_tag=="尾品汇"||options.activity_tag=="最值当"){durationTimeNode.parent().find("#promo-more").show().find("a").attr("href",options.promotion_more_url).attr("dd_name","查看更多"+options.activity_tag+"商品").html("查看更多"+options.activity_tag+"商品&gt;&gt;")}else{durationTimeNode.parent().find("#promo-more").show().find("a").attr("href",options.promotion_more_url)}durationTimeNode.parent().find("#presale-rule").hide()}else{durationTimeNode.parent().find("#promo-more").hide()}if(!options.hasOwnProperty("text")){options.text="距结束还有"}function update(durationTime){var days=Math.floor((durationTime/3600)/24);var hours=Math.floor((durationTime-days*24*3600)/3600);var minutes=Math.floor((durationTime-days*24*3600-hours*3600)/60);var seconds=Math.floor(durationTime%60);if(hours<10){hours="0"+hours}if(minutes<10){minutes="0"+String(minutes)}if(seconds<10){seconds="0"+seconds}var html="<span>"+options.text+"</span>";if(0!==days){html+="<b>"+days+"</b><span>天</span>"}html+="<b>"+hours+"</b><span>时</span>"+"<b>"+minutes+"</b><span>分</span>"+"<b>"+seconds+"</b><span>秒</span>";durationTimeNode.html(html).parent().show()}var durationTime=options.durationTime;if(!options.limit||durationTime<3*24*60*60){update(durationTime)}clearInterval(countDownSh);countDownSh=setInterval(function(){if(0>=durationTime||(("stopCondition" in options)&&!options.stopCondition())){("callback" in options)&&options.callback();clearInterval(countDownSh);$("body").trigger("updatePromo").trigger("initOperation")}else{if(!options.limit||durationTime<3*24*60*60){update(durationTime)}durationTime-=1}},1000)}function setMobilePrice(price){var mobilePriceNode=$("#mobile-price");$("#mina_img_div").hide();$("#mina_img_div_big").hide();var isMobilePrice=false;if(("mobilePrice" in price)&&getFinalPrice()>parseFloat(price.mobilePrice)){mobilePriceNode.find(".t").html("手机专享价");mobilePriceNode.find(".pr").html("<span class='yen'>&yen;</span>"+price.mobilePrice);mobilePriceNode.find(".ph_erwei").prop("src","/?r=callback/mobile-qr&productId="+require().productId);mobilePriceNode.off().hover(function(){$(this).toggleClass("price_ph_hover")}).removeClass("j_pintuan").show();isMobilePrice=true}else{mobilePriceNode.hide();$("#mina_img_div").show();$("#mina_img_div_big").hide();mobilePriceNode.off("hover");isMobilePrice=false}return isMobilePrice}function setPintuanPrice(){var pintuan=require().pintuan;var endPriceExcVip=require().price.endPriceExcVip;var mobilePriceNode=$("#mobile-price");if(pintuan&&pintuan.pintuan_price){mobilePriceNode.hide();if(parseFloat(pintuan.pintuan_price)<parseFloat(endPriceExcVip)){mobilePriceNode.find(".t").html("拼团价<span class='num'>"+pintuan.member_num+"人团</span>");mobilePriceNode.find(".pr").html("<span class='yen'>&yen;</span>"+pintuan.pintuan_price);mobilePriceNode.find(".pintuan_juhuama").prop("src","/?r=callback/get-mini-program-qr&productId="+require().productId);mobilePriceNode.find(".pr").off().hover(function(){mobilePriceNode.addClass("pintuan_hover")});mobilePriceNode.find(".close").off().on("click",function(){mobilePriceNode.removeClass("pintuan_hover")});$("#mina_img_div").hide();$("#mina_img_div_big").hide();mobilePriceNode.addClass("pintuan_hover j_pintuan").show()}}}function setVipHtml(type){var text="";var vipNode=$("#dd-vip");if(type==="shop"){text+="店铺";text+=vipInfo.userShopType.name}else{text=vipInfo.name}vipNode.show().find(">span").html(text)}function setOrdinaryProductVipPrice(){if(require().price.abtest=="b"){return}var priceNode=require().price;var vipPrice;if(undefined===vipInfo){getVipInfo()}else{if(~~priceNode.isVipPrice===1||~~priceNode.isVipDiscount===1){if(vipInfo.userType>0){vipPrice=priceNode.vipPrice["p"+vipInfo.userType];if(parseFloat(vipPrice)<getFinalPrice()){setPrice(priceNode.vipPrice["p"+vipInfo.userType],"VIP价");setVipHtml("dang")}}}else{if("shopVip" in vipInfo.userShopType&&~~priceNode.shopVip===1&&vipInfo.userShopType.discount<10){vipPrice=vipInfo.userShopType.discount*priceNode.salePrice/10;
if(parseFloat(vipPrice)<getFinalPrice()){setPrice(vipPrice,"VIP价");setVipHtml("shop")}}}}}function setVipPrice(){$("#dd-vip-price").hide();var priceNode=require().price;var vipType;var vipPrice;var vipTagName;var ddVip;if(undefined===vipInfo){getVipInfo()}if((~~priceNode.isVipPrice===1||~~priceNode.isVipDiscount===1)&&typeof(priceNode.vipPrice)!="undefined"){vipType="dang";if(JSON.stringify(require().price.promoVipPrice)!="{}"){ddVip=require().price.promoVipPrice}else{ddVip=require().price.vipPrice}}else{if(~~priceNode.shopVip===1&&priceNode.isVipDiscount!==1&&typeof(priceNode.shopVipPrice)!="undefined"){vipType="shop"}else{return}}var old_price=priceNode.endPriceExcVip;if(undefined===vipInfo||vipInfo.userType<0){vipPrice=vipType=="dang"?(typeof(ddVip["p2"])!="undefined"?ddVip["p2"]:priceNode.salePrice):(typeof(priceNode.shopVipPrice["p4"])!="undefined"?priceNode.shopVipPrice["p4"]*old_price/10:priceNode.salePrice);vipTagName=vipType=="dang"?"钻石VIP":"店铺VIP";if(parseFloat(vipPrice)<old_price){var vip_html=vipTagName+' &yen; <span class="price">'+formatPrice(vipPrice)+"</span>";$("#dd-vip-price").addClass("before_user_price").html(vip_html).show();if($("#mobile-price").is(":hidden")){$("#mina_img_div").hide();$("#mina_img_div_big").show()}}}else{if((vipType=="dang"&&vipInfo.userType==0)||(vipType=="shop"&&typeof(vipInfo.userShopType.discount)=="undefined")){vipPrice=vipType=="dang"?(typeof(ddVip["p2"])!="undefined"?ddVip["p2"]:priceNode.salePrice):(typeof(priceNode.shopVipPrice["p4"])!="undefined"?priceNode.shopVipPrice["p4"]*old_price/10:priceNode.salePrice);vipTagName=vipType=="dang"?"钻石VIP":"店铺VIP";if(parseFloat(vipPrice)<old_price){var vip_html=vipTagName+' &yen; <span class="price">'+formatPrice(vipPrice)+"</span>";$("#dd-vip-price").addClass("before_user_price").html(vip_html).show();if($("#mobile-price").is(":hidden")){$("#mina_img_div").hide();$("#mina_img_div_big").show()}}}else{$("#dd-vip-price").html("");vipPrice=vipType=="dang"?(typeof(ddVip["p"+vipInfo.userType])!="undefined"?ddVip["p"+vipInfo.userType]:priceNode.salePrice):(typeof(vipInfo.userShopType.discount)!="undefined"?vipInfo.userShopType.discount*old_price/10:priceNode.salePrice);vipTagName=vipType=="dang"?vipInfo.name:"店铺VIP";if(parseFloat(vipPrice)<old_price){setPrice(vipPrice,vipTagName);if(parseFloat(old_price)>parseFloat(vipPrice)){$("#dd-vip-price").html("普通会员&yen;<span>"+old_price+"</span>").removeClass("before_user_price").show();if($("#mobile-price").is(":hidden")){$("#mina_img_div").hide();$("#mina_img_div_big").show()}}if(~~priceNode.isVipPrice==1){$("#duration-time").parent().hide();clearInterval(countDownSh)}}}}}function setPreSalePrice(){var params=require(),options={};var serverTime=prodDCutil.time.getServerTime();var preSaleRuleNode=$("#presale-rule");var stockInfo=geo.stockInfo();clearPreSalePrice();if(~~params.preSale.isPreSale===0&&stockInfo.stockType==="preSale"){setOrdinaryPreSale();return}if(~~params.preSale.isPreSale===0){isOrdinaryPreSale=isDepositPreSale=false;return}switch(~~params.preSale.type){case 0:setOrdinaryPreSale();break;case 1:case 2:setDepositPreSale();break}function setDepositPreSale(){isDepositPreSale=true;$("#dd-zhe").hide();if(~~params.preSale.type===1){setPrice(params.preSale.rankList[0].price,"预售价")}else{if(params.preSale.rankList.length===1){setPrice(params.preSale.depositAmount,"定金")}else{setPrice(params.preSale.depositAmount,"定金")}}if(require().isVirtualProduct){var presale_text=$("#virtual-detail-price").find("b").html();if(presale_text=="套餐价："){$("#virtual-detail-price").html("<b>预售价：</b>&yen;"+params.preSale.rankList[0].price)}}updatePreSaleTitle(params.preSale.title);updateDepositHtml(params.preSale);showTip("deposit");if(stockInfo.stockType!=="noStock"){$("#geo-info").find(">div > b").text("可预订");stockInfo.stockType="preSale"}if(params.preSale.endDate-serverTime<0||params.preSale.startDate-serverTime>0){$("#geo-info").find(">div > b").hide();return}}function setOrdinaryPreSale(){if(stockInfo.stockType==="realStock"){isOrdinaryPreSale=isDepositPreSale=false;return}var geoInfo=$("#geo-info");var arriveTime=$("#arrive-time");isOrdinaryPreSale=true;updateSalePrice(params.price.salePrice);updatePreSaleTitle(params.preSale.title);if(~~params.shopId>0){options={limit:false,style:"price_time_dj"};if(params.preSale.startDate-serverTime>0){setCountDown({limit:false,style:"price_time_dj",text:"距开始还有",durationTime:params.preSale.startDate-serverTime});geoInfo.find(">div > b").hide()}else{if(params.preSale.endDate-serverTime>0){setCountDown({limit:false,style:"price_time_dj",text:"距结束还有",durationTime:params.preSale.endDate-serverTime})}else{geoInfo.find(">div > b").hide()}}showTip("ordinary")}}function showTip(type){preSaleRuleNode.find("> div[data-type="+type+"]").attr("style","").siblings("div").hide();preSaleRuleNode.show().off().hover(function(){if(type=="ordinary"){$(this).toggleClass("yushou_hover")}else{if(type=="deposit"){$(this).toggleClass("mingxi_hover")}}})}function updatePreSaleTitle(title){$("#presale-title").html(title).show()
}function getPreSalePrice(){var salePrice=$("#deposit_step").data("cur-price");if(salePrice===undefined){return require().price.salePrice}return formatPrice(salePrice)}function updateDepositHtml(preSale){var preSalePriceHtml=[];if(preSale.type==1){var showDJPrice=formatPrice(preSale.depositAmount);preSalePriceHtml.push('<div class="price_hdj">（含定金：&yen');preSalePriceHtml.push(showDJPrice);preSalePriceHtml.push("）</div>")}else{if(preSale.type==2&&preSale.rankNum==1){var showPresalePrice=formatPrice(preSale.rankList[0].price);preSalePriceHtml.push('<div class="price_d price_dj price_dj02"><p class="t">预售价</p><p><span class="yen">&yen</span>');preSalePriceHtml.push(showPresalePrice);preSalePriceHtml.push("</p></div>")}}$("#pc-price").find(".price_d").after(preSalePriceHtml.join(""))}function updateSalePrice(price){var options={price:{directPrice:formatPrice(price)},type:"preSalePrice",data:{text:"预售价"}},params=require().price;if(params.isVipDiscount=="1"){options.price.vipPrice={p1:price*params.discount.d1,p2:price*params.discount.d2,p3:price*params.discount.d3}}$("body").trigger("updatePrice",options)}}function clearPreSalePrice(){$("#pc-price").find(".price_dj,.price_hdj").remove();$("#presale-rule").hide();$("#presale-title").hide();$("#buyarea_price").siblings("span[data-type=dj]").remove()}function setEBookPrice(){var params=require();if(!showEBookCondition(params)){setEBookPrice=function(){};$("#pc-price").siblings(".price_e").remove();return}$.getJSON(window.localUrl,{r:"callback/product-info",productId:params.eBookId,isCatalog:0,shopId:0},function(response){if(response.errMsg!==""){return}var eBookInfo=response.data;var promo=eBookInfo.spu.promotion;var eBookPriceNode=$("#e-book-price");if("p230" in promo){eBookPriceNode.html(promo.p230.price.directPrice);setTimeout(function(){eBookPriceNode.html(eBookInfo.spu.price.salePrice)},promo.p230.endTime-prodDCutil.time.getServerTime())}else{if("p102" in promo){eBookPriceNode.html(promo.p102.price.directPrice);setTimeout(function(){eBookPriceNode.html(eBookInfo.spu.price.salePrice)},promo.p102.endTime-prodDCutil.time.getServerTime())}}});function showEBookCondition(params){if(~~params.eBookId<=0||params.shopId>0){return false}if(isDepositPreSale){return false}return true}}function setPodPrice(){var params=require();if(params.isPod==0&&params.podId>0){$.getJSON(window.localUrl,{r:"callback/product-info",productId:params.podId,isCatalog:0,shopId:0},function(response){if(response.errMsg!==""){return}if(response.data["spu"]["status"]==1||response.data["spu"]["status"]==7){$("#pod_buy_button").remove();return}var podInfo=response.data;var promo=podInfo.spu.promotion;var podPriceNode=$("#pod-price");if("p230" in promo){podPriceNode.html(promo.p230.price.directPrice);setTimeout(function(){podPriceNode.html(podInfo.spu.price.salePrice)},promo.p230.endTime-prodDCutil.time.getServerTime())}else{if("p102" in promo){podPriceNode.html(promo.p102.price.directPrice);setTimeout(function(){podPriceNode.html(eBookInfo.spu.price.salePrice)},promo.p102.endTime-prodDCutil.time.getServerTime())}else{podPriceNode.html(podInfo.spu.price.salePrice)}}})}}function formatPrice(fPrice){fPrice=Number(fPrice);fPrice=fPrice*100;fPrice=fPrice.toFixed(0);fPrice=fPrice/100;if(fPrice<1000){fPrice=fPrice.toFixed(2)}else{if(fPrice>=1000){fPrice=parseFloat(fPrice.toFixed(2))}}return fPrice}function setVirtualProductPrice(){var params=require();var virtualPrdNode=$("#virtual-prd");if(params.isVirtualProduct<1||virtualPrdNode.length==0){return}setPrice(params.price.salePrice,"套餐价");var len=virtualPrdNode.find(".J-list li").length;if(len>4){virtualPrdNode.find(".tab > li").off().click(function(){$(this).siblings("li").removeClass("now");$(this).addClass("now")});virtualPrdNode.find(".prev").off().click(function(){if($(this).hasClass("btn_none")){return}var curNode=virtualPrdNode.find(".tab > li.now");var index=curNode.index()-3;curNode.removeClass("now");virtualPrdNode.find(".tab > :nth-child("+index+")").addClass("now")});virtualPrdNode.find(".next").off().click(function(){if($(this).hasClass("btn_none")){return}var curNode=virtualPrdNode.find(".tab > li.now");var index=curNode.index()+5;curNode.removeClass("now");virtualPrdNode.find(".tab > :nth-child("+index+")").addClass("now")});virtualPrdNode.find(".J-list").jCarouselLite({btnPrev:"#virtual-prd .prev",btnNext:"#virtual-prd .next",visible:4,scroll:4,circular:false,disabledStyle:"btn_none",speed:50,btnGo:virtualPrdNode.find(".tab > li")})}virtualPrdNode.find(".J-list li").show()}function setPrice(price,text){finalPrice=price;var discountText="";if(~~require().price.originalPrice===0){ddDiscount.hide()}else{finalDiscount=Math.ceil((100*finalPrice)/require().price.originalPrice*10)/100;if(finalDiscount>=10){ddDiscount.hide();discountText=""}else{ddDiscount.show();discountText=finalDiscount<1?"小于1":finalDiscount}}price=formatPrice(price);ddPrice.html('<span class="yen">&yen;</span>'+price);text=""?"当当价":text;$("#dd-price-text").text(text);if(ddDiscount.length>0&&discountText!==""&&!isDepositPreSale){ddDiscount.html("("+discountText+"折)")
}else{ddDiscount.length>0&&ddDiscount.html("")}$("#buyarea_price").html(text+':<span class="price_d">&yen;'+price+"</span>");var originalPriceNode=$("#original-price");if(originalPriceNode.length>0){originalPriceNode.html('<span class="yen">&yen;</span>'+require().price.originalPrice)}$("body").trigger("updatePoints");return true}function loginAction(){showMsgBox("loginAction","","",function(){$("body").trigger("renderAfterLogin")})}function updatePoints(){var pointNode=$("#points-tag");var finalPrince=getFinalPrice();var price=require().price;var preSale=require().preSale;if(preSale.isPreSale==1&&preSale.type==2){finalPrince=preSale.rankList[0].price}var point=parseInt(Math.floor(finalPrince/price.pointRate));if(price.pointRate!=="0"&&point!=0){pointNode.find("a").text(point);pointNode.show()}else{pointNode.hide()}}function getVipInfo(){if(undefined===vipInfo){$.getJSON(window.localUrl,{r:"callback/vip-info",shopId:require().shopId},function(response){if(response.errMsg!==""){return}vipInfo=response.data;$("body").trigger("updatePromo").trigger("initOperation")});vipInfo={userType:-2,userShopType:[]};return vipInfo}return vipInfo}function updateLoginVender(){if(vipInfo===undefined||vipInfo.userType==-2){vipInfo=undefined;getVipInfo()}$("body").trigger("requestCollect").trigger("showCommentScore")}function checkVipPrice(priceNode,promoPriceNode,checkPrice){var key;if(checkPrice===1||checkPrice===2){if(isPromoPrice==false){if(parseFloat(priceNode.salePrice)<parseFloat(promoPriceNode.directPrice)){return{type:-1}}}else{if(parseFloat(ordinaryPromoPrice)<=parseFloat(promoPriceNode.directPrice)){return{type:-1}}}if(vipInfo!==undefined&&vipInfo.userType>0&&~~priceNode.isVipPrice===1){key="p"+vipInfo.userType;if(priceNode.vipPrice[key]<parseFloat(promoPriceNode.directPrice)){return{type:-1}}}ordinaryPromoPrice=promoPriceNode.directPrice}isPromoPrice=true;if(vipInfo===undefined){getVipInfo();return{type:0,price:promoPriceNode.directPrice}}if(("vipPrice" in promoPriceNode)&&vipInfo.userType>0&&~~priceNode.isVipDiscount===1){key="p"+vipInfo.userType;return{price:promoPriceNode.vipPrice[key],level:vipInfo.userType,vipType:"dang",type:1}}if(~~priceNode.shopVip===1&&"shopVip" in vipInfo.userShopType){return{price:promoPriceNode.directPrice*vipInfo.userShopType.discount/10,level:vipInfo.userShopType.shopVip,vipType:"shop",type:1}}return{type:0,price:promoPriceNode.directPrice}}function checkPrice(priceNode,promoPriceNode,checkPrice){var isValid=false;if(typeof(promoPriceNode)=="undefined"){return isValid}var endPrice;var endPriceTag="";if(checkPrice===1){if(parseFloat(require().price.endPriceExcVip)>parseFloat(promoPriceNode.price.directPrice)){endPrice=promoPriceNode.price.directPrice;endPriceTag=promoPriceNode.text;setPrice(endPrice,endPriceTag);require().price.endPriceExcVip=endPrice;isValid=true}}else{if(checkPrice===0){endPrice=promoPriceNode.price.directPrice;endPriceTag=promoPriceNode.text;setPrice(endPrice,endPriceTag);require().price.endPriceExcVip=endPrice;isValid=true}else{if(checkPrice===2){if(parseFloat(require().price.endPriceExcVip)>=parseFloat(promoPriceNode.price.directPrice)){endPrice=promoPriceNode.price.directPrice;endPriceTag=promoPriceNode.text;setPrice(endPrice,endPriceTag);require().price.endPriceExcVip=endPrice;isValid=true}}}}if(isValid&&("vipPrice" in promoPriceNode.price)&&~~priceNode.isVipDiscount===1){require().price.promoVipPrice=promoPriceNode.price.vipPrice}return isValid}function updatePrice(event,options){if(price.priceab=="b"){updatePrice2(event,options);return}var isVaild=false;var priceInfo=require().price;var checkVipRet;switch(options.type){case"mobile":isVaild=setMobilePrice(options.data);break;case"preSalePrice":checkVipRet=checkVipPrice(priceInfo,options.price,0);if(0===checkVipRet.type){$("#dd-vip").hide();setPrice(checkVipRet.price,options.data.text)}else{setPrice(checkVipRet.price,"VIP价");setVipHtml(checkVipRet.vipType)}break;case"a88":case"a90":case"p102":case"p228":case"p230":if($.inArray(options.type,["a88","a90"])!=-1){checkVipRet=checkVipPrice(priceInfo,options.data.price,1)}else{checkVipRet=checkVipPrice(priceInfo,options.data.price,2)}if(-1===checkVipRet.type){break}if(0===checkVipRet.type){$("#dd-vip").hide();setPrice(checkVipRet.price,options.data.text)}else{setPrice(checkVipRet.price,"VIP价");setVipHtml(checkVipRet.vipType)}setCountDown(options.data.countDown);isVaild=true;break}setPintuanPrice();if(!isVaild&&("failedCallback" in options)){options.failedCallback()}}function updatePrice2(event,options){var isVaild=false;var priceInfo=require().price;switch(options.type){case"mobile":isVaild=setMobilePrice(options.data);break;case"preSalePrice":isVaild=checkPrice(priceInfo,{"text":options.data.text,"price":options.price},0);setVipPrice();break;case"a88":case"a90":case"p102":case"p228":case"p230":if($.inArray(options.type,["a88","a90"])!=-1){isVaild=checkPrice(priceInfo,options.data,2)}else{isVaild=checkPrice(priceInfo,options.data,1)}if(isVaild){setCountDown(options.data.countDown)
}setVipPrice();break}setPintuanPrice();if(!isVaild&&("failedCallback" in options)){options.failedCallback()}}function priceBind(){$("#pc-price").find(".mingxi").hover(function(){$(this).toggleClass("mingxi_hover");var left=$(this).position().left;var mingxi_width=$(this).width();var mingxi_pop_width=$(this).find(".mingxi_pop").width();if((left+mingxi_width-20)>=mingxi_pop_width){$(this).find(".mingxi_pop").attr("style","")}else{$(this).find(".mingxi_pop").css({left:-left})}});$("#dd-vip-price").on("click","#check_login",function(){$("body").trigger("loginAction")});(function(){var btn=$("#eBook-download");var popDiv=$("#eBook-pop");var inputText=popDiv.find("input");var downloadHrefBtn=inputText.siblings("a");var isOpen=false;var mobileReg=/^1[34578]+\d{9}$/;var defaultText="输入您的手机号码";popDiv.appendTo("body");btn.click(function(){if(isOpen){return}inputText.prop("value",defaultText);inputText.removeClass();downloadHrefBtn.siblings("span").hide().html("");popDiv.show();isOpen=true});popDiv.find(".close").click(function(){popDiv.hide();isOpen=false});inputText.focusin(function(){if(inputText.val()===defaultText){inputText.val("")}inputText.removeClass();downloadHrefBtn.siblings("span").hide().html("")}).focusout(function(){if(inputText.val()===""){inputText.val(defaultText)}else{if(!mobileReg.test(inputText.val())){updateTip("hint","手机格式不正确，请重新输入")}}});function updateTip(className,text){downloadHrefBtn.siblings("span").removeClass().addClass(className).html("<i></i>"+text).show()}downloadHrefBtn.click(function(){var phoneNumber=inputText.val();if(mobileReg.test(phoneNumber)){inputText.removeClass();downloadHrefBtn.siblings("span").hide();if($(this).attr("class")!==undefined){return}downloadHrefBtn.addClass("error");var time=60,e=setInterval(function(){downloadHrefBtn.text(""+time+"S后重试");time--;if(0===time){clearInterval(e);downloadHrefBtn.text("发送下载链接").removeAttr("class");downloadHrefBtn.siblings("span").hide().html("")}},1000);$.get(window.localUrl,{r:"callback/send-message",mobileNumber:phoneNumber},function(response){if(response!=="0"){updateTip("hint","发送失败")}else{updateTip("success","发送成功，请检查您的手机")}})}else{updateTip("hint","手机格式不正确，请重新输入");inputText.addClass("error")}})})()}function initPrice(){if(countDownSh!==undefined){clearInterval(countDownSh)}$("#mobile-price, #dd-vip, #dd-vip-price").hide();$("#mobile-price.j_pintuan").show();$("#duration-time").parent().hide();var itemPrice=require().price.salePrice;require().price.endPriceExcVip=itemPrice;require().price.promoVipPrice={};setPrice(itemPrice,"当当价");isPromoPrice=false;ordinaryPromoPrice=undefined;setVirtualProductPrice();setPreSalePrice();$("#product_info").attr("dd_name",price.priceab);!(isDepositPreSale)&&(price.priceab=="a"?setOrdinaryProductVipPrice():setVipPrice())}function testPriceDown(){var priceDownNode=$("#price_down");priceDownNode.on("click",function(){var url="/index.php";var param="&r=callback/price-down-box";var urlParam=encodeURIComponent(param);showMsgBox("",urlParam,url,function(){$("body").trigger("renderAfterLogin");$("#MsgBoxFrame").css({"width":"563px","height":"386px"})});$("#price_down_masks").show();var nowPrice=require().price.salePrice;$("#nowPrice").val(nowPrice);var productId=require().productId;$("#productId").val(productId);var shopId=require().shopId;$("#shopId").val(shopId);var shopType=require().shopType;$("#shopType").val(shopType);var categoryPath=require().categoryPath;$("#categoryPath").val(categoryPath);var productName=require().productName;$("#productName").val(productName);return false})}function demo(){alert("11111")}function setproductQrcode(){var params=require();$.getJSON(window.localUrl,{r:"callback/get-mini-product-qr",productId:params.productId,},function(response){if(response.flag){$(".qr_img").attr("src",response.imgUrl)}})}exports.priceab=Cookie.Get("priceab");exports.getFinalDiscount=function(){if(-1===finalDiscount){return Math.ceil(1000*require().price.salePrice/require().price.originalPrice)/1000}return finalDiscount};exports.getFinalPrice=getFinalPrice;exports.getVipInfo=getVipInfo;exports.formatPrice=formatPrice;exports.getPreSaleType=function(){if(isDepositPreSale){return 1}if(isOrdinaryPreSale){return 0}return -1};exports.init=function(){if(1===~~require().isPresent){return}$("body").on("updatePrice",updatePrice).on("initPrice",initPrice).on("loginAction",loginAction).on("updatePoints",updatePoints).on("updatePreSalePrice",setPreSalePrice).on("renderAfterLogin",updateLoginVender);priceBind();initPrice();setEBookPrice();setPodPrice();setPintuanPrice();testPriceDown();setproductQrcode()};return exports})(jQuery);var geo=(function(h){var d=h("#geo-pop-name");var n=null,g=null;var m=h("#geo-info");var i=h("#geo-name");var j=true;var l={stockType:"noStock",wareHouseId:"-1",isLocalStore:"-1"};var f={};var c=h("#arrive-time");function p(){return{productId:item.base.productId,isRegionPromo:("promotion" in item)&&("p228" in item.promotion),stockStatus:item.stock.stockStatus,shopId:item.base.shopId,templateId:item.base.templateId,isPresent:item.base.isPresent,isWireless:item.base.isWireless,isPod:item.base.isPod,isJit:item.base.isJit,isVirtualProduct:item.base.isVirtualProduct}}function a(){var u="";u=Cookie.Get("dest_area");var w=["province","city","district","town"];this.country={id:9000,name:"中国"};this.province={id:-1,name:""};this.city={id:-1,name:""};this.district={id:-1,name:""};this.town={id:-1,name:""};if(u!=undefined&&0!==u.length){var v=u.split("&");var q=false;for(var s=0;s<v.length;s++){var t=v[s].split("=");if(t[1]==="0"){t[1]=-1}var r=h.trim(t[0]).slice(0,-3);if(q){this[r].id=-1;continue}this[r].id=h.trim(t[1]);if(parseInt(t[1])===-1){q=true}}for(s=1;s<w.length;s++){r=w[s];if(this[r].id==this[w[s-1]].id||this[w[s-1]]==-1){this[r].id=-1}}}this.getLastAddress=function(){var y=w.length-1;do{var x=w[y];if(this[x].id!=-1){return this[x].id}}while(--y>=0);return -1};this.getFourLevelAddress=function(){var y=w.length-1;y=y==3?2:y;do{var x=w[y];if(this[x].id!=-1){return this[x].id}}while(--y>=0);return -1};this.updateAddress=function(x){var A,z=true;h(d).html("");for(var y=0;y<w.length;y++){A=w[y];if(undefined!==x[A]&&z&&x[A].id!=-1){this[A].name=x[A].name;this[A].id=x[A].id;h(d).append("<li><a href='javascript:;'>"+x[A].name+"</a>")}else{z=false}}};this.clearAddress=function(x){for(var y=x+1;y<w.length;y++){if(undefined!==w[y]){this[w[y]].id=-1;this[w[y]].name=""}}};this.getKey=function(x){if(-1===x){return"country"}return w[x]};this.getIdx=function(y){for(var x=0;x<w.length;x++){if(y==w[x]){return x}}};this.setAreaCookie=function(){var x="country_id="+this.country.id+"&province_id="+this.province.id+"&city_id="+this.city.id+"&district_id="+this.district.id+"&town_id="+this.town.id;initCookie.setAreaCookie(x,2)}}function b(q){var s=[1,14,401,3];var r=[172,173];var t="";if(h.inArray(~~q.province.id,r)!==-1){return q.city.name}t+=q.province.name;if(undefined!==q.city&&h.inArray(~~q.city.id,s)==-1){t+=q.city.name}else{t=q.city.name}if(undefined!==q.district){t+=q.district.name}else{return t}if(undefined!==q.town){t+=q.town.name}return t}var o={clear:function(){c.html("")},get:function(u,s,r,q,t){if(c.html()!==""){return}h.getJSON(window.localUrl,{r:"callback/get-promise",shopId:u,productId:s,warehouseId:r,stockType:q,srcWarehouseId:t,provinceId:n.province.id,cityId:n.city.id,districtId:n.district.id,townId:n.town.id},function(v){if(v.errMsg!=""){return}if(v.data!=""){c.html(v.data);if(h("#deposit-send-date").length>0){v.data=v.data.replace(/<(\/)?b>|&nbsp;/g,"");h("#deposit-send-date").html(v.data).show()}}})}};f.stockInfo=function(){return l};f.getGeoInfo=function(){return n};function e(){var r=p();freight.clear();o.clear();h.getJSON(window.localUrl,{r:"callback/transfer",productId:r.productId,isRegionPromo:r.isRegionPromo?1:0,shopId:r.shopId,customAddress:j?1:0,stockStatus:r.isPod==1?"podStock":r.stockStatus,templateId:r.templateId,provinceId:n.province.id,cityId:n.city.id,districtId:n.district.id,townId:n.town.id,areaId:n.getFourLevelAddress()},function(v){if(v.errMsg!==""){return}v=v.data;l.stockType=v.stockType;if("wareHouseId" in v){l.wareHouseId=v.wareHouseId;l.isLocalStore=v.isLocalStore}if(v.hasOwnProperty("deliveryAddress")){h("#shop-geo-name").text(h.trim(v.deliveryAddress)+" 至")}if(j==true){i.text(b(v.address));n.updateAddress(v.address);g=h.extend(true,{},n);d.find(">li:last").click()}var s="",u={realStock:"有货",noStock:"缺货",preSale:"可预订",podStock:"无现货，随时可以为您单印一本"};if(v.stockType in u){s=u[v.stockType]}if(q(r,v.stockType)){m.find(">div>b").text(s)}if(r.isJit&&r.isJit==1&&v.stockType!="noStock"){m.find(">div>b").text("进口书预订，需要1-3个月发货")}h("body").trigger("updatePromo").trigger("initOperation");if(!q(r,v.stockType)){m.find(">div>b").text("")}if(!(p().isVirtualProduct&&r.shopId===0)){if(v.stockType=="noStock"||v.stockType=="podStock"){h("#deposit-send-date").html("")}else{o.get(r.shopId,r.productId,v.wareHouseId,v.type,v.srcWarehouseId)}}freight.set(r.shopId,n.getLastAddress(),r.templateId,1)});function q(t,s){if(s=="noStock"&&t.isWireless>0){return false}return true}}function k(){var r=h("#geo-pop");var q=r.find(">ul").not(".tab");h(document).on("click",function(z){if(r.length==0||r.css("display")=="none"){return}var A=["geo-pop > ul","geo-name"],y=A.length-1,x,B=true,t=z?z:window.event,u=t.srcElement||t.target;do{var w=h("#"+A[y]),v=u;if(w.length>0){while(B&&v!=null&&"undefined"!=typeof(v.tagName)){for(x=0;B&&x<w.length;x++){if(v.outerHTML===h(w[x]).prop("outerHTML")){B=false}}v=v.parentElement}}if(false===B){return}}while(y--);r.hide();i.removeClass("text_hover")});i.on("click",function(){i.addClass("text_hover");r.show()});d.on("click",">li",function(){var t=h(this).index();var v=h(q[t]);var u=g[g.getKey(t-1)].id;s(t);if(u!=v.data("areaId")||0===v.text().length){h.getJSON(window.localUrl,{r:"callback/get-geography",areaId:u},function(y){if(y.errMsg!==""){return}y=y.data;var x="";for(var w in y.geography){x+="<li data-gid='"+w.substr(1)+"'><a href='javascript:;'>"+y.geography[w]+"</a></li>"}"b"==y.style?v.addClass("list_notaligned"):v.removeClass("list_notaligned");v.length>0&&v.html(x);v.data("areaId",u)})}else{if(v.find("> li").length==1){v.find("> li").click()}}});q.off("click").on("click","> li",function(){var w=h(this).data("gid");var t=g.getIdx(h(this).parent().data("list-name"));if(w=="80000"){return false}g[g.getKey(t)].id=w;g[g.getKey(t)].name=h(this).text();var v=n.getLastAddress();if(w==n[n.getKey(t)].id&&v!=w){d.find("li:eq("+(t+1)+")").click();return}if(t==3&&n.getLastAddress()==w){r.hide();i.removeClass("text_hover");return}var u=h(q[t+1]);h.getJSON(window.localUrl,{r:"callback/get-geography",areaId:w},function(z){if(z.errMsg!==""){return}z=z.data;g.clearAddress(t);d.find(">li:gt("+(t+1)+")").remove();d.find(">li:eq("+(t)+") > a").text(g[g.getKey(t)].name);if(0===z.geography.length){j=false;m.find(">div>b").text("");h.extend(true,n,g);e();i.text(b(g));n.updateAddress(g);if(typeof initCookie!="undefined"){n.setAreaCookie()}r.hide();i.removeClass("text_hover");s(t);return}var y="";for(var x in z.geography){y+="<li data-gid='"+x.substr(1)+"'><a href='javascript:;'>"+z.geography[x]+"</a></li>"}"b"==z.style?u.addClass("list_notaligned"):u.removeClass("list_notaligned");u.html(y);s(t+1);g.clearAddress(t);d.find(">li:eq("+(t+1)+") > a").text("请选择");if(u.find("> li").length==1){u.find("> li").click()}})});function s(t){var u=d.find(">li");u.removeClass("choose");if(u.length==t){u.parent().append("<li><a href='javascript:;'></a></li>");u=d.find(">li")}u[t].className="choose";h(q).hide();h(q[t]).show()}}f.init=function(){n=g=new a();if(~~p().isPresent===1){return}h("body").on("updateStock",e);k();e()};return f})(jQuery);var detail=(function($){var detailNode=$("#detail"),exports={};var tabPanels=$("#tab-panels");var tabPanels2=$("#tab-panels2");var virtualProductDetail=$("#virtual-detail");var isScrool=false;function require(){return{productId:item.base.productId,templateType:item.base.template,shopId:item.base.shopId,categoryPath:item.base.categoryPath,describeMap:item.base.describeMap,spuId:item.base.mainProductId,isPod:item.base.isPod,podId:item.base.podId}}function tabSwitch(e){var data=e.data;var thisObj=e.target||e.srcElement;var type=$(thisObj).attr("id").substring(0,$(thisObj).attr("id").indexOf("_"));$(thisObj).addClass("hover").siblings().removeClass("hover");if(type=="detail"){$(thisObj).parents(".t_box").find("div[id$='_all']").show();$("#price-explain").show()}else{if($(thisObj).attr("isload")!="1"){if(type=="comment"){comment.init()}else{if(type=="question"){question.init()}else{if(type=="jmpm"){jingmai.init()}else{$("#"+type+"_all").load(window.localUrl+"?r=callback/special-tabs&productId="+require().productId+"&tabId="+type+"&isSpec="+$(thisObj).data("is-spec"))
}}}}$(thisObj).parents(".t_box").find("div[id$='_all']").hide();$("#"+type+"_all").show();$("#price-explain").hide()}var top=$("#"+type+"_all").offset().top;if(!$.support.leadingWhitespace){top=(type=="detail")?(top-22):(top-10)}else{top=(type=="detail")?(top-5):top}if(tabPanels.hasClass("tab_panel_fixed")&&isScrool){$("html,body").animate({scrollTop:top},100)}}tabPanels2.find("li[id*='_tab']").on("click",tabSwitch);function initVirtualProduct(){virtualProductDetail.length>0&&(function(){var visible=3;if(!isWidth){visible=2}else{if(require().templateType!=="publish"){visible=4}}var virtualDetailList=virtualProductDetail.find(".list > div > ul > li");var curLength=virtualDetailList.length;$.each(virtualDetailList,function(idx,n){var screen="w_";if(!isWidth){screen="n_"}var pit=screen+Math.floor(idx/visible)+"_"+Math.floor(idx%visible);$(n).attr("ddt-pit",pit)});if(curLength>visible){if(curLength%visible>0){var needPadding=visible-(curLength%visible);var html="";for(var i=0;i<needPadding;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   i++){html+="<li></li>"}virtualProductDetail.find(".list > div > ul").append(html)}virtualProductDetail.find(".list > .next").removeClass("btn_none");virtualProductDetail.find(".list > div").jCarouselLite({btnNext:"#virtual-detail .list > .next",btnPrev:"#virtual-detail .list > .prev",visible:visible,scroll:visible,circular:false,disabledStyle:"btn_none"})}else{virtualProductDetail.find(".list > .btn_a").hide();virtualProductDetail.find(".list > div > ul.clearfix > li:first > div.add").remove()}})()}function suitImage(){if($(this).prop("src").indexOf("grey")>0){return}if("1"==$(this).attr("isModify")){$(this).css({width:"auto",height:"auto"});$(this).removeAttr("isModify")}var maxWidth=900;if(require().templateType=="publish"){maxWidth=800}if(!isWidth){maxWidth=700}if(this.width>maxWidth){var resultHeight=(maxWidth/this.width)*this.height;$(this).css({width:maxWidth,height:resultHeight})}}function initHtml(html){detailNode.html(html);var images=detailNode.find("img");images.each(function(idx,item){item=$(item);
    if(item.attr("href")==undefined){return}if(undefined==item.attr("width")&&undefined==item.attr("height")){$(item).css({width:200,height:200}).attr("isModify","1")}});detailNode.find("img").ddlazyload({appear:1}).on("load",suitImage);detailNode.find("a[id*='-btn']").on("click",function(){var module=$(this).attr("id").replace("-btn","");var textareaNode=$("#"+module+"-textarea");var showNode=$("#"+module+"-show");var showAllNode=$("#"+module+"-show-all");if(textareaNode.length>0){var text=textareaNode.val();textareaNode.remove();showAllNode.html(text.replace(/\n/g,"").replace(/font-size.+?;/ig,""))}var ddName="";if(showAllNode.css("display")=="none"){ddName="显示部分信息";$(this).attr("dd_name",ddName).text(ddName);showNode.hide();showAllNode.show()}else{ddName="显示全部信息";$(this).attr("dd_name",ddName).text(ddName);showNode.show();showAllNode.hide()}if(module=="attachImage"){showAllNode.find("img").ddlazyload({appear:1}).on("load",suitImage)}});(function(){var extractId=$("#extract");var readOnlineNode=$("#read-online");
    if(extractId.length<=0||readOnlineNode.length<=0){return}readOnlineNode.show();readOnlineNode.removeAttr("target");readOnlineNode.click(function(){var tmpTop=0;$("#detail_tab").click();var id=setInterval(function goToExtract(){var top=extractId.offset().top-$("#tab-panels").height();if(tmpTop==top){clearInterval(id);return}tmpTop=top;$("html,body").scrollTop(top)},15)})}())}function scrollBind(){var ulBak=tabPanels2.find("ul").clone();var ulEmptyBak=tabPanels.find("ul").clone();$(window).scroll(function(){var windowTop;if(document.body.scrollTop){windowTop=document.body.scrollTop}else{windowTop=document.documentElement.scrollTop}var f=$("#review_point").offset();var rightOperationNode=$("#operation-fix");var rightNavLoc=rightOperationNode.offset();var buttonEndTop=$("#button_endpoint").offset().top;if(windowTop>buttonEndTop){tabPanels.addClass("tab_panel_fixed").show();rightOperationNode.hide();if(windowTop>f.top){rightOperationNode.show();if(!isScrool){ulBak=tabPanels2.find("ul").clone();
    tabPanels.find("ul").html(ulBak.html());tabPanels2.find("ul").html(ulEmptyBak.html());tabPanels.find("li[id*='_tab']").off("click").on("click",tabSwitch);isScrool=true}}else{tabPanels.find(".live800").html($("#live800").parent().html()).find("#live800").html('<a href="javascript:void(0)" title="点此与客服交流">联系商家</a>');if(isScrool){ulBak=tabPanels.find("ul").clone();tabPanels.find("ul").html(ulEmptyBak.html());tabPanels2.find("ul").html(ulBak.html());tabPanels2.find("li[id*='_tab']").off("click").on("click",tabSwitch);isScrool=false}}}else{rightOperationNode.hide();tabPanels.removeClass("tab_panel_fixed").hide()}var labels=$("#navigation-labels");var t=labels.find("> .hover");if($(t).length==0){t=windowTop}else{t=$(t).offset().top}var arr=labels.find("> [data-idx]").removeClass("hover");var id;for(var i=0;i<arr.length;i++){id="#"+$(arr[i]).data("idx");if($(id).offset().top<=t&&$(id).offset().top+$(id).height()>t){$(arr[i]).addClass("hover");break}}if(arr.length>0){var start="#"+$(arr[0]).data("idx");
    var end="#"+$(arr[arr.length-1]).data("idx");if($(end).offset().top+$(end).height()<rightNavLoc.top+rightOperationNode.height()){rightOperationNode.hide()}}else{if($("#detail").offset().top+$("#detail").height()<rightNavLoc.top+rightOperationNode.height()){rightOperationNode.hide()}}})}exports.init=function(){if(require().templateType=="publish"){$.getJSON(window.localUrl,{r:"callback/detail",productId:require().isPod==1&&require().podId>0?require().podId:require().productId,templateType:require().templateType,describeMap:require().describeMap,shopId:require().shopId,categoryPath:require().categoryPath},function(response){if(response.errMsg!=""||response.data.html==""){return}if(isWidth){var labels=$("#navigation-labels");labels.html(juicer($("#navigation-templates").html(),response.data)).show().parent()}initHtml(response.data.html);if(isWidth){labels.find("> li").on("click",function(){var idx=$(this).data("idx");if(idx==undefined){return}$("html,body").animate({scrollTop:$("#"+idx).offset().top-tabPanels.height()},800)
})}})}else{$.get(window.localUrl,{r:"callback/detail",productId:require().spuId,templateType:require().templateType,describeMap:require().describeMap,shopId:require().shopId,categoryPath:require().categoryPath},function(response){if(response==""){return}initHtml(response)})}scrollBind();initVirtualProduct()};return exports})(jQuery);var comment;
comment=function(){function g(){return{productId:item.base.mainProductId,categoryPath:item.base.categoryPath,mediumId:item.base.mediumId,mainProductId:item.base.mainProductId,template:item.base.template}}function x(){function d(){var d={};$(this).hasClass("current")?d.tagId=0:(d.tagId=$(this).data("tag-id"),$(this).parent().siblings().find("a.current").removeClass("current"),p.find("span").removeClass("on"));$(this).toggleClass("current");p.find("span:first").addClass("on");d.pageIndex=1;h(d)}(function(){var e=
g();$.getJSON(window.localUrl,{r:"comment/label",productId:0<e.mainProductId?e.mainProductId:e.productId,categoryPath:e.categoryPath},function(a){var b=$("#comment_tags_tpl").html();if(""!==a.errMsg)f.html(juicer(b).render({tags:[]}));else{a=juicer(b).render(a.data);f.html(a);var c=f.find(".comment_tag_total");72<c.height()?(c.addClass("comment_tag_total_up"),c.find("> a").click(function(){c.toggleClass("comment_tag_total_up")})):f.find(".comment_tag_total > .up").hide();f.find("span > a").click(d)}})})()}
function y(){function d(a){var b=1;if(!$(this).hasClass("active")){b="prev"===a.data.type?parseInt($("#comment_page a.on").text())-1:"next"===a.data.type?parseInt($("#comment_page a.on").text())+1:parseInt($(this).text());if(null!==a.data.long_or_short||void 0!==a.data.long_or_short||""!==a.data.long_or_short)var c=a.data.long_or_short;h({pageIndex:b,pageClick:!0,long_or_short:c})}}function e(a){var b=$(this).parent().prev("ul.pic_show").find("li.on").index(),c=$(this).parent().prev("ul.pic_show").children().length;
if("prev"===a.data.type&&0!==b)b--;else if("next"===a.data.type&&b!==c-1)b++;else return;$(this).parent().prev("ul.pic_show").find("li:eq("+b+") a").click()}p.on("click","span",function(){var a={};$(this).hasClass("on")&&0===f.find("span > a.current").length||($(this).addClass("on").siblings().removeClass("on"),f.find("div.comment_tag_total > span > a").removeClass("current"),f.find("a.selected").removeClass("selected"),a.pageIndex=1,h(a))});k.find(".pl02").click(function(){$(this).parent().toggleClass(" comment_sort_hover")});
k.find("ul > li > a").click(function(){k.find(".pl02").text($(this).text());k.toggleClass(" comment_sort_hover");h({pageIndex:1})});$(document).click(function(a){if(k.hasClass("comment_sort_hover")){a=a?a:window.event;a=a.srcElement||a.target;for(var b=!0;null!==a&&"undefined"!==typeof a.tagName;)a.outerHTML===k.prop("outerHTML")&&(b=!1),a=a.parentElement;b&&k.removeClass("comment_sort_hover")}});m.on("click","#comment_page div > a.J-num",{long_or_short:"short"},d).on("click","#comment_page a.back",
{type:"prev",long_or_short:"short"},d).on("click","#comment_page a.next",{type:"next",long_or_short:"short"},d);t.on("click","#long_comment_page div > a.J-num",{long_or_short:"long"},d).on("click","#long_comment_page a.back",{type:"prev",long_or_short:"long"},d).on("click","#long_comment_page a.next",{type:"next",long_or_short:"long"},d);m.on("click",".J-show_all_comment",function(){var a=$(this),b=a.prev("span"),c=b.html();b.html(a.next("span").html());a.next("span").html(c);a.find("i").hasClass("up")?
a.html("展开评论<i ></i>"):a.html('收起评论<i class="up"></i>')}).on("click","ul.pic_show a",function(){var a=$(this);m.find(">.item_wrap").find(".pic_show_big").hide();var b=a.parent().parent().next(".pic_show_big");a.parent().hasClass("on")?(b.hide(),a.parent("li").removeClass("on")):(b.find("img").attr("src",a.find("img").data("big-pic")).end().show(),m.find(">.item_wrap").find("li").removeClass("on"),a.parent("li").addClass("on"));b=a.parent().parent().siblings(".pic_show_big").find(".big_pic_left");
0===a.parent().index()?b.hide():b.show();b=a.parent().parent().siblings(".pic_show_big").find(".big_pic_right");a.parent().index()===a.parent().parent().find("li").length-1?b.hide():b.show()}).on("click","span.big_pic_left",{type:"prev"},e).on("click","span.big_pic_right",{type:"next"},e).on("click",".pic_show_big img",function(){$(this).parent().parent().prev().find(".on").removeClass("on");$(this).parent().parent().hide()}).on("mouseover","ul.pic_show li",function(){$(this).addClass("hover")}).on("mouseout",
"ul.pic_show li",function(){$(this).removeClass("hover")});m.on("click","div.support > a",function(){var a=$(this).data("type"),b=$(this);if($(this).hasClass("cannot")||$(this).hasClass("now"))return!1;var c=$(this).hasClass("now")?1:2;"cai"===a&&(c+=2);(function l(b){function d(a,c){return 1E4<=a?Number(Math.floor(a/1E3)/10).toFixed(1)+"万":1<=a?a:c}function u(c,b){var r=c.data("number");void 0===b?r+=1:--r;c.html(d(r,"cai"===a?"踩":"赞"))}var q=g();if(0===b.length)return!1;var e=b.parent().data("comment-id");
$.getJSON("/",{r:"comment/save-useful",productId:q.productId,mainProductId:q.mainProductId,commentId:b.parent().data("comment-id"),status:c,commentType:0},function(a){""===a.errMsg?2===c||4===c?(b.addClass("now"),b.siblings().addClass("cannot"),u(b)):(b.removeClass("now"),b.siblings().removeClass("cannot"),u(b,!0)):"not login."===a.errMsg&&showMsgBox("loginAction","","",function(){var a=$('[data-comment-id="'+e+'"'),a=0===a.length?a:2>=c?a.children(".zan"):a.children(".cai");l(a,c);setTimeout(function(){$("body").trigger("renderAfterLogin")},
1E3)})})})(b)});t.on("click","div.support > a",function(){var a=$(this).data("type"),b=$(this);if($(this).hasClass("cannot")||$(this).hasClass("now"))return!1;var c=$(this).hasClass("now")?1:2;"cai"===a&&(c+=2);(function l(b){function d(a,c){return 1E4<=a?Number(Math.floor(a/1E3)/10).toFixed(1)+"万":1<=a?a:c}function e(c,b){var l=c.data("number");void 0===b?l+=1:--l;c.html(d(l,"cai"===a?"踩":"赞"))}var q=g();if(0===b.length)return!1;var f=b.parent().data("comment-id");$.getJSON("/",{r:"comment/save-useful",
productId:q.productId,mainProductId:q.mainProductId,commentId:b.parent().data("comment-id"),status:c,commentType:1},function(a){""===a.errMsg?2===c||4===c?(b.addClass("now"),b.siblings().addClass("cannot"),e(b)):(b.removeClass("now"),b.siblings().removeClass("cannot"),e(b,!0)):"not login."===a.errMsg&&showMsgBox("loginAction","","",function(){var a=$('[data-comment-id="'+f+'"'),a=0===a.length?a:2>=c?a.children(".zan"):a.children(".cai");l(a,c);setTimeout(function(){$("body").trigger("renderAfterLogin")},
1E3)})})})(b)})}function h(d){function e(a,b){function d(a,b){var c=220,n,c=1.8;b||(a=100===a?99.999:a,c=0);if(0!==a)return b?(n=220+c,c=220+3.6*a-c):(n=220-3.6*a+c,c=220-c),c=c*Math.PI/180,n=n*Math.PI/180,["M"+(57+54*Math.sin(c)),57-54*Math.cos(c)+"A54",54,0,50.5<a?1:0,0,57+54*Math.sin(n),57-54*Math.cos(n)].join()}var e=$("#comment_percent"),f=$("#comment-percent"),g="";a=100===a||0===a||0===a%1?parseInt(a):parseFloat(a).toFixed(1);e.html(a+"<i>%</i>");0===a?(g="processingbar4",b&&(g="processingbar3 processingbar3_none"),
f.hide()):(g=60>=a?"processingbar3":85<a?"processingbar":"processingbar2",f.show());f.parent().removeClass().addClass(g);f.find("#J-deep").attr("d",d(a,!1));f.find("#J-light").attr("d",d(100-a,!0))}var a=!1;void 0!==d&&"pageClick"in d&&(a=!0,delete d.pageClick);var b=$.extend(function(){var a=0,b=1,d=0,e=f.find("a.current");0<e.length&&(a=e.data("tag-id"),d=e.data("tag-num"));"时间排序"===k.find(".pl02").text()&&(b=2);var e=p.find("span.on").data("type"),h=1;1!==e&&2!==e&&(h=0);return{r:"comment/list",
productId:g().productId,categoryPath:g().categoryPath,mainProductId:g().mainProductId,mediumId:g().mediumId,pageIndex:1,sortType:b,filterType:e,isSystem:h,tagId:a,tagFilterCount:d,template:g().template}}(),d);$.ajax({url:window.localUrl,type:"GET",dataType:"JSON",data:b,success:function(c){if(""===c.errMsg){if("undefined"!==typeof c.data.list){if(1===b.pageIndex&&c.data.list.summary){var d=c.data.list.summary,f=p.find("span");$(f[0]).html("全部（"+d.total_comment_num+"）");$(f[1]).html("好评（"+d.total_crazy_count+
"）");$(f[2]).html("中评（"+d.total_indifferent_count+"）");$(f[3]).html("差评（"+d.total_detest_count+"）");$(f[4]).html("晒图（"+d.total_image_count+"）");e(d.goodRate,0<d.total_comment_num);"undefined"!=typeof window.commentCustNum?d.total_comment_num=parseInt(d.total_comment_num)+window.commentCustNum:"undefined"!=typeof window.commentNum&&(d.total_comment_num=parseInt(window.commentNum));$("#comment_total_num_title").html(d.total_comment_num);$("#comm_num_down").html(parseInt(d.total_comment_num)+parseInt(d.long_comment_count));
$("#comment_tab").html("商品评论("+(parseInt(d.total_comment_num)+parseInt(d.long_comment_count))+")");$(f[0]).html("全部（"+d.total_comment_num+"）")}m.html(c.data.list.html);a&&$("html,body").animate({scrollTop:$("#comment_all").offset().top-45},0)}"undefined"!==typeof c.data.longlist&&($("#comment_long_total_num_title").html(c.data.longlist.summary.long_comment_count),t.html(c.data.longlist.html),a&&$("html,body").animate({scrollTop:$("#w-long-comment").offset().top-60},0))}}})}var v={},p=$("#comment_num_tab"),
f=$("#comment_tags_div"),k=$("#comment_sort"),m=$("#comment_list"),t=$("#comment_long_list"),w=$("#comm_num_down");0<w.length&&w.click(function(){$("html,body").animate({scrollTop:$("#comment_point").offset().top-45},0);$("#comment_tab").click()});v.init=function(){$("#comment_tab").attr("isload","1");y();x();h();$("body").on("renderAfterLogin",function(){var d=$("#comment_page").find("a.on").html();isNaN(d)&&(d=1);h({pageIndex:d})})};return v}();
var question=function(){function b(){return{productId:item.base.productId,templateType:item.base.template,shopId:item.base.shopId,categoryPath:item.base.categoryPath,describeMap:item.base.describeMap,mainProductId:item.base.mainProductId}}function d(a){var c={r:"callback/question-list",productId:0<b().mainProductId?b().mainProductId:b().productId,templateType:b().templateType,pageIndex:1};a&&(c=$.extend(c,a));$.ajax({type:"GET",url:window.localUrl,data:c,success:function(a){$("#question_all").html(a);
$("#question_tab").html("商品问答("+$("#question_total_count").text()+")")}})}function e(){qid=$(this).attr("id").replace("question_answer_","");showMsgBox($(this).attr("id"),"","",function(){window.location.href="http://itemqa.dangdang.com/question/questiondetail.php?question_id="+qid});return!1}function f(){var a=b().productId;showMsgBox("question_new","","",function(){window.location.href="http://itemqa.dangdang.com/question/question.php?product_id="+a});return!1}return{init:function(){d();$("#question_tab").attr("isload",
"1");$("#question_all").on("click","[id^='question_answer_']",e).on("click","#question_new",f)},questionSlide:function(a){var c={},b=$("#question_page").find("a.on").text();$(a).hasClass("next")?c.pageIndex=~~b+1:$(a).hasClass("back")?c.pageIndex=~~b-1:c.pageIndex=$(a).text();d(c)}}}(jQuery);
var jingmai=(function(){function require(){return{productId:item.base.productId,templateType:item.base.template,shopId:item.base.shopId,categoryPath:item.base.categoryPath,describeMap:item.base.describeMap,mainProductId:item.base.mainProductId}
}var exports={};exports.init=function(){getJingMai({pageIndex:1});$("#jmpm_tab").attr("isload","1")};function getJingMai(param){var data={r:"callback/get-star-list",productId:require().mainProductId>0?require().mainProductId:require().productId,pageIndex:param.pageIndex};
    if(param){data=$.extend(data,param)}$.ajax({type:"GET",url:window.localUrl,data:data,success:function(data){console.log(data);$("#jmpm_all").html(data);var param={type:""};$("#jingmai_page a.J-num").on("click",function(){param={type:""};
        $(this).addClass("on").siblings("a").removeClass("on");pageNumClick(param)});$("#jingmai_page a.back").on("click",function(){param={type:"prev"};pageNumClick(param)});$("#jingmai_page a.next").on("click",function(){param={type:"next"};
        pageNumClick(param)})}})}function pageNumClick(paramIn){var pageIndex=1;if($(this).hasClass("active")){return}if(paramIn.type==="prev"){pageIndex=parseInt($("#jingmai_page a.on").text())-1}else{if(paramIn.type==="next"){pageIndex=parseInt($("#jingmai_page a.on").text())+1
}else{pageIndex=parseInt($("#jingmai_page a.on").text())}}getJingMai({pageIndex:pageIndex})}return exports})(jQuery);var promotion=(function($){var exports={};var promoList=$("#promo-list");var promoTemplate=[];var require=function(){return{productId:item.base.productId,shopId:item.base.shopId,mainProductId:item.base.mainProductId,productName:item.base.productName,promotion:item.promotion,activity:"activity" in item?item.activity:undefined,price:item.price,isCatalog:item.base.isCatalog,preSale:item.preSale,isPresent:item.base.isPresent,productType:item.base.productType}};var promoMag=(function(){function init(){markTable={promotion:{},activity:{},preSale:false,mobilePrice:false}}function set(keys,value){for(var i=0;i<keys.length;i++){var key=keys[i];var prefix=getType(key);if(prefix===key){markTable[key]=value}else{markTable[prefix][key]=value}}}function get(key){var prefix=getType(key);if(prefix===key){return markTable[key]}return markTable[prefix][key]}function getType(key){if(key.substr(0,1)==="p"&&parseInt(key.substr(1))>0){return"promotion"}if(key.substr(0,1)==="a"&&parseInt(key.substr(1))>0){return"activity"}return key}function hasPromotion(){for(var p in markTable.promotion){if(markTable.promotion.hasOwnProperty(p)&&markTable.promotion[p]){return true}}return false}function offPromo(type){if(type in markTable){markTable[type]=false}else{for(var attr in markTable[type]){if(markTable[type].hasOwnProperty(attr)){markTable[type][attr]=false}}}}var markTable={};init();return{on:function(key){var keys=[];if(key instanceof Array){keys=key.slice(key,0)}else{keys=Array.prototype.slice.call(arguments)}set(keys,true)},off:function(key){var keys=[];if(key instanceof Array){keys=key.slice(key,0)}else{keys=Array.prototype.slice.call(arguments)}set(keys,false)},hasPromo:function(){var result=false,i;if(arguments.length===0){return hasPromotion()}for(i=0;i<arguments.length;i++){result|=get(arguments[i])}return result},init:init,offAllPromo:function(type){if(type instanceof Array){$.each(type,function(idx,key){offPromo(key)})}else{$.each(arguments,function(idx,key){offPromo(key)})}}}})();var promoBuyNumLimiter=(function(){var limiter={};return{set:function(options){limiter[options.type]=$.extend(true,{},options)},get:function(){var result;$.each(["p230","p102","p228","a88","a90","depositPreSale"],function(idx,item){if(promoMag.hasPromo(item)&&item in limiter){if(limiter[item].hasOwnProperty("max_limit_number")&&limiter[item].max_limit_number>=10000){return}result=limiter[item]}});if(result==undefined){if(promoMag.hasPromo("p5")&&"p5" in limiter){result=limiter["p5"]}else{if(promoMag.hasPromo("p51")&&"p51" in limiter){result=limiter["p51"]}else{for(var item in limiter){result=limiter[item]}}}}return result},clear:function(){limiter={}}}})();var specialPromo={promotion228:function(node){var stockInfo=geo.stockInfo();var now=prodDCutil.time.getServerTime();var provinceId=geo.getGeoInfo().province.id;var endTime=-1;var dimensionNode;if(stockInfo.stockType!="realStock"||stockInfo.isLocalStore!=1){promoMag.off("p228");return}function set228(endTime,promoPrice){var durationTime=endTime-now;if(durationTime>0){promoMag.on("p228");$("body").trigger("updatePrice",[{type:"p228",data:{price:promoPrice,text:"抢购价",countDown:{durationTime:durationTime}},failedCallback:function(){promoMag.off("p228")}}])}}for(var i in node){if(node[i] instanceof Function){continue}if(dimensionNode!=undefined){break}if(node[i].endTime<=now){continue}for(var p=0;p<node[i].dimension.length;p++){if($.inArray(""+provinceId,node[i].dimension[p].region)>=0){if(parseFloat(node[i].dimension[p].price.directPrice)>parseFloat(require().price.salePrice)){continue}dimensionNode=node[i].dimension[p];endTime=node[i].endTime;break}}}if(undefined!=dimensionNode){set228(endTime,dimensionNode.price);if(promoMag.hasPromo("p228")){promoBuyNumLimiter.set({max_limit_number:dimensionNode.limitNumber,type:"p228"})}}else{promoMag.off("p228")}},promotion102:function(node){var durationTime=node.endTime-prodDCutil.time.getServerTime();if(durationTime<0){delete item.promotion.p102;promoMag.off("p102");return}promoMag.on("p102");$("body").trigger("updatePrice",[{type:"p102",data:{price:node.price,text:(node.activity_tag&&node.activity_tag!="限时抢")?(node.activity_tag+"价"):"抢购价",countDown:{durationTime:durationTime,promotion_more_url:"http://promo.dangdang.com/"+node.promoId,activity_tag:node.activity_tag}},failedCallback:function(){promoMag.off("p102")}}]);if(promoMag.hasPromo("p102")){promoBuyNumLimiter.set({max_limit_number:node.limitNumber,type:"p102"})}},promotion230:function(node){var durationTime=node.endTime-prodDCutil.time.getServerTime();if(durationTime<0){delete item.promotion.p230;promoMag.on("p102");return}promoMag.on("p230");$("body").trigger("updatePrice",[{type:"p230",data:{price:node.price,text:"秒杀价",countDown:{durationTime:durationTime}},failedCallback:function(){promoMag.off("p230")}}]);if(promoMag.hasPromo("p230")){promoBuyNumLimiter.set({max_limit_number:node.limitNumber,type:"p230"})}},promotion1:function(node){var vipInfo=price.getVipInfo();var info=node.text.ordinary,i;var priceInfo=require().price;
        var title="多买多折";var discount=100;if(priceInfo.isVipDiscount=="1"){if((~~vipInfo.userType)>0){discount=priceInfo.discount["d"+vipInfo.userType];title=vipInfo.name}}if(undefined!==info&&priceInfo.shopVip=="1"){if("shopVip" in vipInfo.userShopType){discount=vipInfo.userShopType.discount*10;title=vipInfo.userShopType.name}}for(i=0;i<info.length;i++){info[i].price=formatPromoPrice(info[i].discount*priceInfo.salePrice/100,discount)}var text='<p><span class="text">';for(i=0;i<info.length;i++){text+="购买满"+info[i].number+"件，享&yen;"+info[i].price+"/件";if(info.length-1==i){text+="</span></p>";break}text+=(1==i%2)?'</span></p><p><span class="text">':"；"}promoMag.on("p1");promoMag.off("mobilePrice");return{text:text,title:title}},promotion225:function(node,cacheData){var maxShowCount=isWidth?5:4;var promotionId;if(node.promoId instanceof Array){promotionId=node.promoId.join(",")}else{promotionId=node.promoId}if(cacheData.currentId!=promotionId){getP225Data(promotionId,cacheData)}else{bindClick(cacheData[promotionId])}function getP225Data(promotionId,cacheData){if(cacheData.hasOwnProperty(promotionId)&&!$.isEmptyObject(cacheData[promotionId])){cacheData.currentId=promotionId;initP225(cacheData[promotionId]);bindClick(cacheData[promotionId])}else{if(!cacheData.hasOwnProperty(promotionId)){cacheData[promotionId]={};$.getJSON(window.localUrl,{r:"callback/get-promotion225-detail",promotionId:promotionId,productId:require().productId,shopId:require().shopId,productType:require().productType},function(response){if(response.errMsg!=""||response.data.length==0){promoMag.off("p225");return}var p225Node=response.data;cacheData[promotionId]=p225Node;cacheData.currentId=promotionId;initP225(p225Node);bindClick(p225Node)})}}}function initP225(node){var buyPackage=$("#buyPackage");var buyTogether=$("#buyTogether");var hasBuyTogether=false,i;if($.trim(buyTogether.text()).length!=0){hasBuyTogether=true;if(buyPackage.find('ul.tab>li[data-type="buyPackage"]').length==0){buyTogether.find("ul.tab").prepend('<li data-type="buyPackage">优惠套餐</li>');buyTogether.hide()}}var html=[],text="";html.push('<ul class="tab clearfix">');html.push('<li class="hover" data-type="buyPackage">优惠套餐</li>');hasBuyTogether&&html.push('<li data-type="buyTogether">拍档组合</li>');html.push("</ul>");if(node.length==1){text='style="display:none"'}html.push('<ul class="tab2">');for(i=1;i<=node.length&&i<=9;i++){html.push("<li "+text+">优惠套餐"+i+"</li>")}html.push("</ul>");buyPackage.html(html.join("")).show()}function bindClick(p225Node){var packageNode=$("#right-content").find(".group_buy:first");packageNode.find(".tab2 > li").click(function(){var idx=$(this).index();var data;$(this).siblings().removeClass("hover");$(this).addClass("hover");packageNode.find(".over").remove();packageNode.find(".group_info").remove();data=$.extend(true,{},p225Node[idx]);data.index=idx+1;var curProduct,params=require(),curData=$.extend(true,{},data),totalDangPrice=0;curData.products=[];for(var i=0;i<data.products.length;i++){if(data.products[i].productId==params.productId||data.products[i].productId==params.mainProductId){curProduct=data.products[i];curProduct.selectProductId=params.productId;curProduct.price=params.price.salePrice;curProduct.ddtPit=Math.floor(i/maxShowCount)+"_"+Math.floor(i%maxShowCount);curData.products.unshift(curProduct);totalDangPrice+=parseFloat(curProduct.price)*curProduct.number}else{curData.products.push(data.products[i]);totalDangPrice+=parseFloat(data.products[i].price)*data.products[i].number}}curData.totalDangPrice=price.formatPrice(totalDangPrice);curData.productId=params.productId;curData.titleText=$(this).text();curData.width=maxShowCount;curData.ddtArea="027_"+idx;var screen="w_";if(!isWidth){screen="n_"}for(var j=0;j<curData.products.length;j++){curData.products[j]["ddtPit"]=screen+Math.floor(j/curData.width)+"_"+Math.floor(j%curData.width)}packageNode.find(".tab2").after(juicer(getTemplate("p225"),curData));packageNode.find("#promotion_buyButton").click(function(){recommend.addCart("promotion_lists",225)});if(curData.products.length>maxShowCount){var curIndex=0,maxIndex=Math.ceil(curData.products.length/maxShowCount)-1;packageNode.find(".over > div").jCarouselLite({btnPrev:"#right-content > .group_buy:first .prev",btnNext:"#right-content > .group_buy:first .next",visible:maxShowCount,scroll:maxShowCount,circular:false,disabledStyle:"btn_none"});if(isWidth){packageNode.find(".over > div").css("margin-left","-40px")}else{packageNode.find(".over > div").css("margin-left","-20px")}}});packageNode.find(".tab2 > li:first").trigger("click");var buyPackageNode=$("#buyPackage");var buyTogetherNode=$("#buyTogether");if($.trim(buyTogetherNode.text()).length>0){$("#buyTogether, #buyPackage").find("ul.tab > li").click(function(){if($(this).data("type")=="buyPackage"){buyPackageNode.show();buyTogetherNode.hide()}else{buyPackageNode.hide();buyTogetherNode.show()}});buyPackageNode.show();buyTogetherNode.hide()}}},activity:function(node){if(node.type===undefined){return}var text="";
        if(~~node.type===88){text="尾品价"}else{if(~~node.type===90){text="值当价"}else{promoMag.off("a"+node.type);return}}if(~~node.endTime-prodDCutil.time.getServerTime()<0){promoMag.off("a"+node.type);return}promoMag.on("a"+node.type);var price={directPrice:node.price};var priceInfo=require().price;if(~~priceInfo.isVipDiscount===1){price.vipPrice=$.extend(true,{},priceInfo.vipPrice)}$("body").trigger("updatePrice",[{type:"a"+node.type,data:{price:price,text:text,countDown:{durationTime:node.endTime-prodDCutil.time.getServerTime()}},failedCallback:function(){promoMag.off("a"+node.type)}}]);if(promoMag.hasPromo("a"+node.type)){promoBuyNumLimiter.set({max_limit_number:node.limitNumber,type:"a"+node.type})}},activity88:function(node){specialPromo.activity(node);if(promoMag.hasPromo("a88")){var breadCrumbOutletsNode=$("#bread-crumb-outlets");breadCrumbOutletsNode.find("a#olbp").attr("href",node.activityUrl);breadCrumbOutletsNode.show().find("img.J-outlets-img").attr("src",isWidth?node.width:node.narrow);breadCrumbOutletsNode.hover(function(){$(this).children(".o_banner,.o_close").fadeIn(100)},function(){$(this).children(".o_banner,.o_close").slideUp(100)});$(".outlets .o_close").click(function(){$(this).parents(".outlets").find(".o_banner,.o_close").slideUp()})}},activity90:function(node){specialPromo.activity(node)},promotion51:function(node){if(!promoMag.hasPromo("p51")){return}promoBuyNumLimiter.set({min_limit_number:node.limitNumber,"type":"p51"});promoMag.on("p51")}};var promoBind=(function(){var p3FirstRequest=true;var selectData={};var animate=true;var p225Cache=[];return{p229:function(htmlDom){if(typeof htmlDom=="undefined"){return}var key="p"+htmlDom.data("promotype");htmlDom.find(".checkboxa").off("click").click(function(){$(this).toggleClass("checkboxa_nonce");var productId=$(this).next().data("pid");var price=$(this).next().data("price");if($(this).hasClass("checkboxa_nonce")){htmlDom.data("select-pid",productId);htmlDom.data("select-prd-price",price);selectData[key]={isSelect:true}}else{htmlDom.removeData("select-pid");htmlDom.removeData("select-prd-price");delete selectData[key]}});if(key in selectData){htmlDom.find(".checkboxa").click()}},p3_28:function(htmlDom){if(typeof htmlDom=="undefined"){return}var type=htmlDom.data("promotype");var key="p"+type;var selectBuyId=htmlDom.find(".xuan_gou");if(!(key in selectData)){selectData[key]={isClose:0}}htmlDom.find(".xuan_gou").off("click").click(function(){$(this).toggleClass("xuan_gou_hover");if($(this).text()=="收起"){$(this).text($(this).data("text"));selectData[key].isClose=1}else{$(this).data("text",$(this).text());$(this).text("收起");selectData[key].isClose=0}$(this).siblings("div").toggle("slow","linear")});if((key in selectData)&&selectData[key].isClose==1){selectBuyId.removeClass("xuan_gou_hover").text(selectBuyId.data("text")).siblings("div").hide()}var tab=htmlDom.find(".tab"),productList=htmlDom.find(".list");if(tab.find("> li").length==0){tab.siblings("a").hide()}else{var btn=tab.siblings("a");productList.hover(function(){btn.toggle()});btn.hover(function(){btn.toggle()});var width=htmlDom.data("show-width");var start=0;productList.jCarouselLite({btnNext:btn[1],btnPrev:btn[0],btnGo:tab.find("> li"),visible:parseInt(width),scroll:parseInt(width),start:start,stopAnimateOption:function(){return animate},afterEnd:function(){if(animate){selectData[key].pageIdx=tab.find(".now").index()}}});$(btn[1]).on("click",function(){var list=tab.find("> li");var node=tab.find("> .now");var cur=node.index();var idx=cur>=list.length-width?0:cur+width;node.removeClass("now");$(list[idx]).addClass("now")});$(btn[0]).on("click",function(){var node=tab.find("> .now");var list=tab.find("> li");var cur=node.index();var idx=cur==0?list.length-width:cur-width;node.removeClass("now");$(list[idx]).addClass("now")});tab.find("> li").on("click",function(){$(this).siblings().removeClass("now");$(this).addClass("now")})}var products=productList.find("> ul > li");products.click(function(e){var target=e.target||Event.srcElement;if(target.nodeName.toUpperCase()=="SPAN"||target.nodeName.toUpperCase()=="LI"){var pid=$(this).data("pid");if(pid===undefined){return}if($(this).hasClass("choose")&&type!=3){$(this).removeClass("choose");htmlDom.removeData("select-pid");htmlDom.removeData("select-prd-price");selectData[key].pidIndex=-1}else{products.removeClass("choose");$.each($(this).siblings("li"),function(i,node){if($(node).data("pid")==pid){$(this).addClass("choose")}});$(this).addClass("choose");htmlDom.data("select-pid",pid);htmlDom.data("select-prd-price",$(this).data("price"));htmlDom.data("select-prd-is-spu",$(this).data("is-spu"));selectData[key].pidIndex=productList.find("> ul > .choose").index()}}}).hover(function(){$(this).toggleClass("pic_hover")});if(type==3&&p3FirstRequest){$(htmlDom.find(".clearfix > li[dd_name$=_1]")[0]).trigger("click");selectBuyId.trigger("click");p3FirstRequest=false}else{if((key) in selectData){animate=false;$(tab.find(">li")[selectData[key].pageIdx]).trigger("click");
        if(selectData[key].pidIndex!=-1){$(products[selectData[key].pidIndex]).trigger("click")}animate=true}}},loginAction:function(){var domHtml=getPromoNode("login");if(getPromoNode("login")!=undefined){domHtml.find("a").on("click",function(){$("body").trigger("loginAction")})}},mobilePrice:function(){$("body").trigger("updatePrice",[{type:"mobile",data:require().price,failedCallback:function(){promoMag.off("mobilePrice")}}])},p225:{on:function(node){specialPromo.promotion225(node,p225Cache)},off:function(){if(p225Cache.hasOwnProperty("currentId")){delete p225Cache.currentId}var buyPackageNode=$("#buyPackage");var buyTogether=$("#buyTogether");buyPackageNode.html("").hide();if(buyTogether.text()!=""){buyTogether.find("ul.tab > li[data-type=buyPackage]").remove();buyTogether.show()}}}}})();function updateIcon(){if($("#main-image-icon").length==0){return}var params=require();var p=[230,102,228,1,201,20,23,205,206,207,225,12,14,28,3,30,229,5,51],i=0;mainImg.icon.unset();if(item.base.icon.length!=0&&item.base.icon["type"]=="flash"){mainImg.icon.set(item.base.icon,"flash");return}if(promoMag.hasPromo("ordinaryPreSale")){mainImg.icon.set(item.attachInfo.iconTable["preSale"],"");return}if(promoMag.hasPromo("depositPreSale")){mainImg.icon.set(item.attachInfo.iconTable["preSaleDeposit"],"");return}if(promoMag.hasPromo("a90")){mainImg.icon.set(item.attachInfo.iconTable["a90"],"");return}if(promoMag.hasPromo("a88")){mainImg.icon.set(item.attachInfo.iconTable["a88"],"");return}for(i=0;i<p.length;i++){var key="p"+p[i];if(key in item.promotion){if(promoMag.hasPromo(key)){mainImg.icon.set(item.attachInfo.iconTable["p"+p[i]],"",p[i]);return}}}if(item.base.icon.length!=0){mainImg.icon.set(item.base.icon,"");return}if(promoMag.hasPromo("mobilePrice")){mainImg.icon.set(item.attachInfo.iconTable["mobilePrice"],"")}}function formatPromoPrice(price,discount){if(discount==undefined){discount=100}price=Number(price*discount);price=price.toFixed(0);price=price/100;return parseFloat(price.toFixed(2))}function vipHtml(){var vipInfo=price.getVipInfo();if(vipInfo===undefined||vipInfo.userType>=0){return""}var priceInfo=require().price;if((priceInfo.isVipDiscount=="1"&&promoMag.hasPromo("vipDiscount"))||(priceInfo.isVipPrice=="1"&&promoMag.hasPromo("vipPrice"))){return'<div class="clearfix" data-promotype="login"><b>VIP优惠</b>'+'<div class="rule rule04">'+'<p><span class="text"><a href="javascript:;">登录</a>后确认是否享有此优惠 </span></p>'+"</div>"+"</div>"}else{if(priceInfo.shopVip=="1"&&promoMag.hasPromo("shopVip")){return'<div class="clearfix" data-promotype="login"><b>店铺VIP</b>'+'<div class="rule rule04">'+'<p><span class="text"><a href="javascript:;">登录</a>后确认是否享有此优惠 </span></p>'+"</div>"+"</div>"}else{return""}}}function getTemplate(promoType){if(promoTemplate.length>0){return promoTemplate[promoType]}var templateHtml=$("#promo-template").find("> script");if(templateHtml.length==0){return}$.each(templateHtml,function(idx,prom){var promoTypes=(""+$(prom).data("promoid")).split("-");for(var i=0;i<promoTypes.length;i++){promoTemplate["p"+promoTypes[i]]=$(prom)}});return promoTemplate[promoType].html()}function getPromoNode(promoType){var promos=$("#promo-list").find(">div");for(var i=0;i<promos.length;i++){if(promoType==$(promos[i]).data("promotype")){return $(promos[i])}}}function updatePromo(){var params=require();var promotion=$.extend(true,{},params.promotion);var bodyNode=$("body");bodyNode.trigger("initPromo").trigger("initPrice").trigger("initBuyNumber");switch(price.getPreSaleType()){case -1:break;case 0:promoMag.on("ordinaryPreSale");break;case 1:promoMag.on("depositPreSale");promoMag.offAllPromo(["activity","promotion","mobilePrice"]);promoMag.off("vipPrice","vipDiscount","shopVip");if(params.preSale.limitBuyNum>0){promoBuyNumLimiter.set({type:"depositPreSale",max_limit_number:params.preSale.limitBuyNum})}break}renderPromo(promotion);if(promoMag.hasPromo("mobilePrice")){promoBind.mobilePrice()}if(promoMag.hasPromo("p225")){promoBind.p225.on(promotion.p225)}else{promoBind.p225.off()}if(promoMag.hasPromo("p229")){promoBind.p229(getPromoNode("229"))}if(promoMag.hasPromo("p28")){promoBind.p3_28(getPromoNode("28"))}if(promoMag.hasPromo("p3")){promoBind.p3_28(getPromoNode("3"))}promoBind.loginAction();var limiterData=promoBuyNumLimiter.get();if(limiterData!=undefined){prodBuyNumber.setBuyNumber(limiterData)}}function renderPromo(promotion){var params=require();$.each(["p230","a88","a90","p102","p228"],function(idx,key){if(!promoMag.hasPromo(key)){return}if(key.substr(0,1)==="a"){specialPromo["activity"+key.substr(1)](params.activity);return}(key in promotion)&&specialPromo["promotion"+key.substr(1)](promotion[key])});var activityFlag=false;$.each(["p228","p102","a90","a88","p230"],function(idx,key){activityFlag&&promoMag.off(key);if(promoMag.hasPromo(key)){activityFlag=true}});if(!promoMag.hasPromo("a88")){$("#bread-crumb-outlets").hide()}if(require().shopId==0&&promoMag.hasPromo("a88","a90")){promoMag.off("p5","p51");promoMag.off("p1");promoMag.off("p3","p28","p229");
    promoMag.off("p20","p22","p23","p201","p205","p206","p207","p225","p226")}if("p51" in promotion){specialPromo["promotion51"](promotion["p51"])}var promoType=[229];promoType=promoType.concat([1,5,102]);promoType=promoType.concat([20,23,205,206,207,201]);promoType=promoType.concat([12,14]);promoType=promoType.concat([3,28,30]);promoType=promoType.concat([209]);promoType=promoType.concat([232]);var turnPagePromo=[3,28];var html=price.priceab=="a"?vipHtml():"";if(0===promoList.length){return}for(var i=0;i<promoType.length;i++){var tmpPromoType="p"+promoType[i];if(!promoMag.hasPromo(tmpPromoType)){continue}if(tmpPromoType in promotion){var node=promotion[tmpPromoType];node.rule="";node.ddtArea="";node.promoType=promoType[i];switch(promoType[i]){case 1:var data=specialPromo.promotion1(node);node.text=data.text;node.rule="rule05";if(data.title!=""){node.title=data.title;node.rule="rule06"}break;case 3:node.selectText="选赠品";node.rule="rule02";node.ddtArea="024";node.text=node.isAutoEBook==1?"购买本纸质书可赠送以下任意一本电子书":"购买本商品可赠送以下任意一件商品";node.isMarkup=0;node.len=Math.ceil(node.gifts.length/3);node.width=3;break;case 5:var limiterPromo=promoBuyNumLimiter.get();if(limiterPromo!=undefined&&"max_limit_number" in limiterPromo&&~~limiterPromo.max_limit_number<10000){continue}node.rule="rule03";promoBuyNumLimiter.set({max_limit_number:node.limitNumber,type:tmpPromoType});break;case 201:node.rule="rule03";node.ddtArea="026";promoBuyNumLimiter.set({max_limit_number:node.limitNumber,type:tmpPromoType});break;case 12:node.rule="rule05";break;case 14:node.rule="rule06";break;case 20:node.rule="rule04";promoBuyNumLimiter.set({max_limit_number:node.limitNumber,type:tmpPromoType});break;case 28:node.selectText="选购商品";node.rule="rule03";node.ddtArea="028";node.text="购买本商品可加价换购以下任意一件商品";node.isMarkup=1;node.len=Math.ceil(node.gifts.length/2);node.width=2;break;case 229:node.rule="rule06";node.ddtArea="025";node.title="电子书加价购";break;case 207:promoBuyNumLimiter.set({max_limit_number:node.limitNumber,type:tmpPromoType});break;case 205:node.rule="rule01";promoBuyNumLimiter.set({max_limit_number:node.limitNumber,type:tmpPromoType});break;case 206:case 23:node.rule="rule04";promoBuyNumLimiter.set({max_limit_number:node.limitNumber,type:tmpPromoType});break;case 102:node.title=node.activity_tag?node.activity_tag:"限时抢";var theprice=require().price;if(theprice.is_vip_discount==1&&theprice.is_have_vip_discount==1||theprice.shopVip==1){var ddprice=$("#dd-price").text().substr(1);if(isNaN(ddprice)){continue}node.text="现在购买享受&yen;"+ddprice+",&nbsp;抓紧抢购";break}else{if(theprice.is_vip_discount==1&&theprice.is_have_vip_discount==0){var ddprice=$("#dd-price").text().substr(1);if(isNaN(ddprice)){continue}if(parseFloat(ddprice)<node.price.directPrice){continue}else{node.text="现在购买享受&yen;"+node.price.directPrice+",&nbsp;抓紧抢购";break}}else{if(theprice.is_vip_discount==0){var ddprice=$("#dd-price").text().substr(1);if(isNaN(ddprice)){continue}node.text="现在购买享受&yen;"+ddprice+",&nbsp;抓紧抢购";break}}}case 209:node.rule="rule01";break;case 232:node.rule="rule01";break}for(var k=0;k<turnPagePromo.length;k++){if(promoType[i]==turnPagePromo[k]){var pageSize=node.width;for(var j in node.gifts){node.gifts[j]["ddtPit"]=Math.floor(j/pageSize)+"_"+Math.floor(j%pageSize)}}}var title=node.title;if(title!=null&&Array.isArray(title)){var newNode=JSON.parse(JSON.stringify(node));var promoId=node.promoId;if(promoId!=null&&Array.isArray(promoId)){newNode.promoId=promoId[0]}var promoTotalNum=title.length;for(var pr=0;pr<promoTotalNum;pr++){if(title!=null&&Array.isArray(title)){newNode.title=title[0]}var text=node.text;if(text!=null&&Array.isArray(text)){newNode.text=text[pr]}var limitNumber=node.limitNumber;if(limitNumber!=null&&Array.isArray(limitNumber)){newNode.limitNumber=limitNumber[pr]}var activityUrl=node.activityUrl;if(activityUrl!=null&&Array.isArray(activityUrl)){newNode.activityUrl=activityUrl[pr]}html+=juicer(getTemplate(tmpPromoType),newNode)}}else{html+=juicer(getTemplate(tmpPromoType),node)}}}if(""!==html){promoList.html(html).parent().show().parent().show();if(Object.keys(promotion).length===1){for(var promo in promotion){var title=promotion[promo];if(Array.isArray(title)&&title.length===1){$("#promo-list-tips").hide()}}}if(promotion["p232"]!==undefined){if(Number(require().price.salePrice)<Number(promotion["p232"].price)){if(Object.keys(promotion).length===1){console.log("Object.keys(promotion).length === 1");promoList.parent().parent().hide()}else{promoList.find("[data-promotype='232']").hide()}}}}}function updateDeposit(){var param=require();var preSale=$.extend(true,{},param.preSale);if(preSale.isPreSale!=1||preSale.type==0){return}var stepNode=$("#deposit_step");var orderCount=0;var subProductIds="";if(~~param.isCatalog&&typeof prodSkuInfo!="undefined"){$.each(prodSkuInfo,function(i,n){subProductIds+=","+n.itemId})}$.getJSON(window.localUrl,{r:"callback/get-deposit-order",productId:param.productId,activityId:preSale.activityId,isCatelog:param.isCatalog,subProductIds:subProductIds.substr(1)},function(response){if(response.errMsg!==""){return
}if(preSale.startDate>prodDCutil.time.getServerTime()){orderCount=0}else{orderCount=response.data.orderCount}if(preSale.type=="2"&&preSale.rankNum>1){var select_li=0;stepNode.find("li").each(function(i,n){var num=parseInt($(n).attr("rank_min_num"));select_li=i;if(i==0&&orderCount<num||orderCount==num){return false}else{if(orderCount<num){select_li=--i;return false}}});stepNode.find("li:lt("+~~(select_li+1)+")").addClass("deep");if(orderCount>0){stepNode.find("li:eq("+select_li+")").find(".num").html("<b>已预定"+orderCount+"件</b>").show();var current_step_price=stepNode.find("li:eq("+select_li+")").find(".step_price").html();$("#virtual-detail-price").html("<b>预售价：</b>&yen;"+current_step_price)}var tuan_txt="";var nextStep=(select_li==preSale.rankNum)?select_li:(select_li+1);var needCount=~~stepNode.find("li:eq("+nextStep+")").attr("rank_min_num");var stepMoney=stepNode.find("li:eq("+nextStep+")").find(".price b").text().substr(1);if((needCount-orderCount)>0&&((needCount-orderCount)<=2||(needCount-orderCount)/needCount<=0.2)){tuan_txt="再定"+(needCount-orderCount)+"件，就可以&yen;"+stepMoney+"购买，快邀好友一起购买吧！"}else{tuan_txt="总预定件数越多，价格越低，快邀好友一起购买吧！"}$("#deposit_buy_button").parent().append('<span class="tuan">'+tuan_txt+"</span>");if(geo.stockInfo().stockType.toLowerCase()=="nostock"){$("#deposit_buy_button").parent().find(".tuan").hide()}}else{if(typeof preSale.rankMinNum!="undefined"){updateClustersNum(preSale.rankMinNum,orderCount)}}})}function updateClustersNum(rankNum,orderNum){var html="";if(rankNum>1){html='<span class="tuan">'+rankNum+"人成团</span>"}$(".buy_box_btn").append(html)}function initPromo(){promoList.html("").parent().hide();if(typeof mainImg!="undefined"){mainImg.icon.unset()}promoBuyNumLimiter.clear();var params=require();promoMag.init();for(var promoType in params.promotion){promoMag.on(promoType)}"mobilePrice" in params.price?promoMag.on("mobilePrice"):promoMag.off("mobilePrice");params.price.isVipDiscount==="1"?promoMag.on("vipDiscount"):promoMag.off("vipDiscount");params.price.shopVip==="1"?promoMag.on("shopVip"):promoMag.off("shopVip");params.price.isVipPrice==="1"?promoMag.on("vipPrice"):promoMag.off("vipPrice");if(params.activity!=undefined){promoMag.on("a"+params.activity.type)}}exports.init=function(){if(1===~~require().isPresent){return}$("body").on("initPromo",initPromo).on("updatePromo",updatePromo).trigger("updatePromo");updateDeposit()};exports.hasPromo=function(key){return promoMag.hasPromo(key)};return exports})(jQuery);var coupon=(function($){var exports={};var couponNode;var couponPopNode;var scriptLoad=false;var require=function(){return{productId:item.base.productId,mainProductId:item.base.mainProductId,isCatalog:item.base.isCatalog,isPresent:item.base.isPresent,coupon:item.coupon}};function initCoupon(){couponNode.hide().find("#coupon-list").html("");couponPopNode.hide()}function updateCoupon(){var couponArr=require().coupon;renderCoupon(couponArr);$("#coupon-list").click(function(){getCouponNumber(couponArr)})}function renderCoupon(couponArr){var html="";var data={coupon:couponArr};var templateHtml=couponNode.find("#tpl-page").html();html+=juicer(templateHtml,data);var length=getLen(couponArr);if(""!==html&&length>0){couponNode.find("#coupon-list").html(html).parent().parent().show()}}function getLen(couponArr){var length=0;for(var attr in couponArr){if(typeof couponArr[attr]=="function"){continue}length++}return length}function renderCouponPop(couponArr){var html="";var couponLen=getLen(couponArr);var couponTemp=couponArr;var id="";for(var i=0;i<couponLen;i++){if(couponTemp[i]["restNum"]==undefined||(couponTemp[i]["restNum"]!=undefined&&couponTemp[i]["restNum"]>0)){couponTemp[i]["quanClass"]="quan";couponTemp[i]["btnText"]="立即领取"}else{couponTemp[i]["quanClass"]="quan quan_over";couponTemp[i]["btnText"]="已领取"}}var data={coupon:couponTemp};var templateHtml=$("#coupon-des").html();html+=juicer(templateHtml,data);if(""!==html){couponPopNode.html(html).show()}$("head").append("<script type='text/javascript' id='couponjs_id' src='"+couponJs+"'><\/script>")}function getCouponNumber(couponArr){var couponLen=getLen(couponArr);var couponTemp=couponArr;var couponSerialNum=[];$("body").trigger("renderAfterLogin");for(var i=0;i<couponLen;i++){couponSerialNum[i]=couponArr[i]["activitySerialNum"]}var activitySerialNums=couponSerialNum.join(",");$.getJSON(window.localUrl,{r:"callback/received-coupon-num",activitySerialNums:activitySerialNums},function(response){if(response.errMsg!=""||response.data.length==0){return}var couponNumList=response.data;for(var j=0;j<couponNumList.length;j++){for(var k=0;k<couponLen;k++){if(couponTemp[k]["activitySerialNum"]==couponNumList[j]["activitySerialNum"]){couponTemp[k]["activityAwardNum"]=couponNumList[j]["activityAwardNum"];couponTemp[k]["restNum"]=couponTemp[k]["everyRecNum"]-couponTemp[k]["activityAwardNum"]}}}renderCouponPop(couponTemp)})}function eventBind(){$("#coupon-pop").on("click","#coupon-close",function(){couponPopNode.hide();$(".coupon_dialog").remove();$("#couponjs_id").remove()})}exports.init=function(){if(1===~~require().isPresent){return}couponNode=$("#coupon-node");couponPopNode=$("#coupon-pop");$("body").on("initCoupon",initCoupon).on("updateCoupon",updateCoupon).trigger("updateCoupon");eventBind()};return exports})(jQuery);var recommend=function(c){function e(){return{productId:item.base.productId,categoryPath:item.base.categoryPath,mediumId:item.base.mediumId,mainProductId:item.base.mainProductId,template:item.base.template,shopId:item.base.shopId,stockStatus:item.stock.stockStatus,displayStatus:item.base.displayStatus,salePrice:item.price.salePrice,productName:item.base.productName,productSubName:item.base.productSubName,isCatalog:item.base.isCatalog,isShowOriginalPrice:item.base.isShowOriginalPrice,isWireless:item.base.isWireless,
shopType:item.base.shopType,stockType:item.stock.stockType}}function u(b){var a=item.promotion;if(c.isEmptyObject(a)||!a.p28&&!a.p3)return b;for(var g=0,d=b.length;g<d;g++){var f=[];a.p28?f=a.p28.gifts:a.p3&&(f=a.p3.gifts);for(var e=0,l=f.length;e<l;e++)if(b[g].productId==f[e].productId){delete b[g];break}}return b}function v(b){var a=0,c;for(c in b)"function"!=typeof b[c]&&a++;return a}function w(){c("#buytogether_info span.error").hide();var b=c(this).parents("li"),a=c("#buytogether_info"),g=parseInt(a.find("p.num b").text()),
d=parseFloat(a.find("p.price_all_d span").text().substr(1)),f=parseFloat(b.find(".price_d").text().substr(1));b.hasClass("selected")?(b.removeClass("selected"),g--,d-=f):(b.addClass("selected"),g++,d+=f);a.find("p.num b").text(g);a.find("p.price_all_d span").html("&yen;"+d.toFixed(2))}function q(b,a,c,d){var f=parseInt(a.css("left"))+b;a.animate({left:f},300,function(){parseInt(f)>0-c&&a.css("left",(0-c)*d);f<(0-c)*d&&a.css("left",0-c)})}function x(){var b="publish"==e().template?y:z;c.each(b,function(a,
b){var d=isWidth?925:740,f=c("#"+b),h=f.find(".over"),l=f.find("a.prev"),r=f.find("a.next"),k=isWidth?h.data("pagesize")?h.data("pagesize"):A[b].width:m[b].width,k={btnPrev:"#"+b+" a.prev",btnNext:"#"+b+" a.next",visible:k,scroll:k,circular:!0};l.hasClass("btn_none")&&(k.circular=!1);if("publish"!=e().template||"historyReco"!=b&&"alsoBuy"!=b)h.jCarouselLite(k);else{f.addClass("mbox_another_two");var p=h.find(">ul"),k=h.find("div.list_page"),n=k.length;1==n&&(l.addClass("btn_none"),r.addClass("btn_none"));
h=k.slice(n-1).clone();k=k.slice(0,1).clone();p.prepend(h).append(k)}l.on("click",function(){if("publish"==e().template&&("historyReco"==b||"alsoBuy"==b)){if(p.is(":animated")||1===n)return;q(d,p,d,n)}var a=parseInt(f.find("#now_page").text()),c=parseInt(f.find("#total_page").text()),h=0,h=1==a?c:parseInt(a)-1;f.find("#now_page").text(h)});r.on("click",function(){if("publish"==e().template&&("historyReco"==b||"alsoBuy"==b)){if(p.is(":animated")||1===n)return;q(0-d,p,d,n)}var a=parseInt(f.find("#now_page").text()),
c=parseInt(f.find("#total_page").text()),h=0,h=a==c?1:a+1;f.find("#now_page").text(h)})})}function B(){var b=c("#buyTogether_lists"),a=c("#buyTogether"),g=c("#buyPackage"),d=3;"publish"==e().template&&(d=4);c("#buyTogether, #buyPackage").find("ul.tab > li").off().click(function(){"buyPackage"==c(this).data("type")?(g.show(),a.hide()):(g.hide(),a.show())});isWidth||0===b.length||(b.find("ul > li").length<=d&&a.find("a.btn_a").hide(),0!=c.trim(g.text()).length&&0!=c.trim(a.text()).length&&(g.hide(),
a.show()),b.jCarouselLite({btnPrev:"#buyTogether a.prev",btnNext:"#buyTogether a.next",visible:d,scroll:d,circular:!1,disabledStyle:"btn_none"}),0!=c.trim(g.text()).length&&0!=c.trim(a.text()).length&&(g.show(),a.hide()))}var y=["nostockReco","alsoBuy","historyReco","nosaleReco"],z=["nostockReco","alsoView","historyReco","nosaleReco"],m={alsoBuy:{width:8},nostockReco:{width:5},historyReco:{width:8},nosaleReco:{width:3},buyTogether:{width:3},alsoView:{width:4}},A={alsoBuy:{width:5},nostockReco:{width:6},
historyReco:{width:5},nosaleReco:{width:5},buyTogether:{width:5},alsoView:{width:5}},t={init:function(){if("publish"==e().template)c("#alsoBuy,#alsoView,#alsoAttention,#historyReco").on("mouseover","p.pic",function(){c(this).addClass("pic_hover")}).on("mouseout","p.pic",function(){c(this).removeClass("pic_hover")});else if(c("#alsoView,#alsoAttention,#historyReco").on("mouseover","li",function(){c(this).addClass("pic_hover")}).on("mouseout","li",function(){c(this).removeClass("pic_hover")}),"cloth"==
e().template)c("#alsoBuy").on("mouseover","li",function(){c(this).addClass("pic_hover")}).on("mouseout","li",function(){c(this).removeClass("pic_hover")});c("#buyTogether").on("click","a.choose",w).on("click","#buyTogether_buyButton",function(){if(0==c("#buyTogether_lists").find("li.selected").length)return c(this).next("span.error").show(),!1;t.addCart("buyTogether",2)});"cloth"!==e().template&&delete m.alsoview;c.getJSON(window.localUrl,{r:"callback/recommend",productId:e().mainProductId,shopId:e().shopId,
pageType:e().template,module:"7"==e().displayStatus?"nosale":"",isBroad:isWidth},function(b){if(""!=b.errMsg)return!1;"5"==e().shopType&&"undefined"!=typeof b.data.buyTogether&&unset(reponse.data.buyTogether);for(var a in b.data){var g=c("#"+a+"_tpl");b.data[a].isShowOriginalPrice=e().isShowOriginalPrice;b.data[a].screen="w_";if("buyTogether"==a){if("1"!=e().isWireless)if(b.data.buyTogether.list=u(b.data.buyTogether.list),0==v(b.data.buyTogether.list))c("#"+a).hide();else{var d=[];d.mainProductId=
e().mainProductId;d.productId=e().productId;d.productName=e().productName;d.productSubName=e().productSubName;var f=c("#largePic").attr("src");d.productImage=f.substring(0,f.indexOf("_"))+f.substring(f.indexOf("_")).replace(/u|w|e/,"l");d.salePrice=c("#dd-price").text().substr(1);"1"==e().isShowOriginalPrice&&0<c("#dd-zhe").length?d.discount="("+c("#dd-zhe").text()+")":d.discount="";d.isSpu=e().isCatalog;b.data.buyTogether.list.unshift(d);isWidth||(b.data[a].screen="n_",b.data[a].pagesize=m[a].width,
"publish"==e().template&&(b.data[a].pagesize=4));for(d=1;d<b.data[a].list.length;d++)"undefined"!=typeof b.data[a].list[d]&&(b.data[a].list[d].ddtPit=b.data[a].screen+Math.floor((d-1)/b.data[a].pagesize)+"_"+Math.floor((d-1)%b.data[a].pagesize));g=juicer(g.html(),b.data[a]);c("#"+a).html(g);var h=c("#right-content");0!=h.find(".group_buy:visible").length?(c("#"+a).find("ul.tab").prepend('<li data-type="buyPackage">优惠套餐</li>'),h.find(".group_buy:visible ul.tab").append("<li>拍档组合</li>"),c("#"+a).hide()):
c("#"+a).show();h.find(".group_buy ul.tab li").on("click",function(){var a=c(this).index();h.find(".group_buy:eq("+a+")").show().siblings(".group_buy").hide()})}}else{isWidth||(b.data[a].screen="n_",a in m&&(b.data[a].pagesize=m[a].width,b.data[a].totalPage=Math.ceil(b.data[a].list.length/m[a].width)));for(d in b.data[a].list)b.data[a].list[d].ddtPit=b.data[a].screen+Math.floor(d/b.data[a].pagesize)+"_"+Math.floor(d%b.data[a].pagesize);b.data[a].productId=e().productId;"noStock"!==e().stockType&&
"nostockReco"==a?c("#"+a).html(juicer(g.html(),b.data[a])):c("#"+a).html(juicer(g.html(),b.data[a])).show()}}x();B();""!=point&&(b=c("#"+point).offset().top,c("html,body").animate({scrollTop:b},0),b=point.substring(0,point.indexOf("_"))+"_tab",c("#"+b).click())})},addCart:function(b,a){var g=c("#"+b),d=!1,f=[];g.find("li.zhu,li.selected").each(function(){var a=c(this).data("pid"),b=c(this).data("select-product-id")?c(this).data("select-product-id"):0,e=c(this).data("number"),g=c(this).data("is-spu");
f.push({productId:a,productCount:e,selectProductId:b,isLocal:"0"});"1"==g&&(d=!0)});var e={};225==a&&(e={promoPrice:c("#promotion_buyButton").data("direct-price"),promoId:g.data("promoid"),promoType:"225"});if(d)showListsPop({product:f,moduleType:a,promotion:e,buttonType:"1"});else{for(var g=prodDCutil.getSourceUrl(),g={product:[],referer:g._url,prev_referer:g._referrer},l=0;l<f.length;l++){var m={productId:f[l].productId,productCount:f[l].productCount,promotion:[]};c.isEmptyObject(e)||m.promotion.push({promotionId:e.promoId});
g.product.push(m)}location.href="//shopping.dangdang.com/shoppingcart/cart_append_new?product_ids="+encodeURIComponent(prodDDutil.encodeJson(g))}}};return t}(jQuery);
var online=function(){function a(){return{productId:item.base.mainProductId,categoryPath:item.base.categoryPath,mediumId:item.base.mediumId,mainProductId:item.base.mainProductId,productName:item.base.productName,shopId:item.base.shopId,supId:item.base.supId,isShowRobot:item.base.isShowRobot,itemId:item.base.productId}}function g(f){var b=$("#live800"),c=$("#tab-panels"),d=c.find(".icon_dj"),c=c.find(".live800");if("undefined"==typeof f.group_configs||0==f.group_configs.length){if(0==a().shopId&&"1"==
a().isShowRobot)return $("#robotEntry").show(),$("#live800_div").show(),$("#robotEntry").unbind().bind("click",online.showRobot),d.attr("style","display:block"),d.unbind().bind("click",online.showRobot),!1;b.parent("span").hide();0==b.parents(".s_one").children(":visible").length&&b.parents(".s_one").hide();return!1}f.is_valid?(b.attr("class","onlines"),b.unbind().bind("click",online.showDialog),c.unbind().bind("click",online.showDialog)):(b.attr("class","offlines").attr("title","系统暂时繁忙，请您稍后访问"),
b.unbind().bind("click","return false;"));b.show();b.parent("span").show();b.parents(".s_one").show();$("#live800_div").show()}function k(){0<a().shopId&&$.get(window.localUrl,{r:"callback/get-shop-link-phone",shopId:a().shopId},function(a){a&&($("#live800_div").show(),$("#link-phone").show().find("p").html("联系电话："+a))})}var d={entrance_code:"pc_product_detail",position_code:"main",action:"stats"},c={shop_id:0,product:{product_id:1,product_name:""},supplier_id:0},e={entrance_code:"pc_shop_frontpage",
shop_id:0,fields:"group_configs,service_times,is_valid,user_info",supplier_id:0},h={judge:function(){return!("undefined"==typeof showImDialog||"undefined"==typeof showSupplierImDialog||"undefined"==typeof getMerchantGroupInfo||"undefined"==typeof getSupplierGroupInfo)},init:function(){$.getScript(imipUrl,function(){c={shop_id:a().shopId,product:{product_id:a().productId,product_name:a().productName},supplier_id:a().supId};e.shop_id=a().shopId;e.supplier_id=a().supId;if(!h.judge())return!1;showImDialog(d,
c);0==a().shopId?getSupplierGroupInfo(e,g):getMerchantGroupInfo(e,g)});k()},showDialog:function(){showMsgBox("online_service",c.product.product_id,"",online.callbackShowDialog)},callbackShowDialog:function(){d.action="";0==a().shopId?showSupplierImDialog(d,c):showImDialog(d,c);$("body").trigger("renderAfterLogin")},showGroup:function(a){var b=$("#live800_group_div");$(a).hasClass("score_hover")?($(a).removeClass("score_hover"),b.hide()):($(a).addClass("score_hover"),b.show())},showRobot:function(){var c=
$("#robotEntry").attr("robotUrl");window.open(c+a().itemId)}};return h}();
var search=function(){function e(){var a=arguments,b=a[0]||"",c,d;c=1;for(d=a.length;c<d;c++)b=b.replace(/%s/,a[c]);return b}return{init:function(){$.getJSON(window.localUrl,{r:"callback/get-shop-category",shopId:item.base.shopId},function(a){if(""!=a.errMsg)return!1;var b="",c="";50<a.data.length&&$("#shop_category_list").attr("style","overflow-y:scroll;");for(var d in a.data)a.data.hasOwnProperty(d)&&(b+='<a href="javascript:void(0)" categoryid = '+a.data[d].Category+">"+a.data[d].Name+"</a>",c+=
'<li><a href="'+e("http://shop.dangdang.com/storeoutersearch.php?shop_id=%s&key=%s&inner_cat=%s",a.data[d].shopID,"",a.data[d].Category)+'" target="_blank">'+a.data[d].Name+"</a></li>");""!=b&&($("#category_list").html(b),$("#search").show());""!=c&&$("#shop_category_list").html(c).parent().show()});$("#shop_search_btn").on("click",function(){var a=encodeURIComponent($("#shop_search_text").val()),b=$("#shop_search_category").attr("category"),a=e("http://shop.dangdang.com/storeoutersearch.php?shop_id=%s&key=%s&inner_cat=%s",
item.base.shopId,a,b);$(this).attr("href",a)});$("#category_list").on("click","a",function(){$(this).attr("categoryId");$("#shop_search_category").val($(this).text()).attr("category",$(this).attr("categoryid"));$("#category_list").hide()});$("#show_category_list").click(function(){$("#category_list").is(":hidden")?$("#category_list").show():$("#category_list").hide()});$(document).click(function(a){a=a?a:window.event;"show_category_list"!=(a.srcElement||a.target).id&&$("#category_list").hide()})}}}(jQuery);
var bang=function(){function g(){return{productId:item.base.productId,template:item.base.template,categoryPath:item.base.categoryPath}}function h(){$.getJSON(window.localUrl,{r:"callback/get-bang-rank",productId:g().productId},function(e){if(""==e.errMsg){var c;c='<span class="t1" dd_name="图书排行榜排名">在'+('<a href="'+e.data.url+'" target="_blank">当当'+e.data.pathName+"榜</a>排名");c+='<span class="num">'+e.data.rank+"</span>位</span>";$(".pinglun").prepend(c)}})}function l(){var e=$("#bang_div"),c=$("#bang_tab"),
k=$("#bang_div .list02"),h=$("#bang_div .link_more");$.getJSON(window.localUrl,{r:"callback/get-bang-data",categoryPath:g().categoryPath},function(a){if(""==a.errMsg){var b="",d=!1;"undefined"!=typeof a.data.hotBang&&0<a.data.hotBang.data.length&&(b+='<li dd_name="畅销榜">畅销榜</li>',d=!0);"undefined"!=typeof a.data.newBang&&0<a.data.newBang.data.length&&(b+='<li dd_name="新书榜">新书榜</li>',d=!0);if(0==d)return!1;e.show();c.html(b).find("li").mouseover(function(){$(this).addClass("hover").siblings().removeClass("hover");
k.eq($(this).index()).show().siblings(".list02").hide();h.eq($(this).index()).show().siblings(".link_more").hide()});for(var f in a.data)a.data.hasOwnProperty(f)&&(b="",b=juicer('{@each data as list,index}\r\n\t\t\t\t\t\t\t\t<li ddt-pit="${index}">\r\n\t\t\t\t\t\t\t\t\t<span class="num {@if index<3}num_top3{@/if}">${parseInt(index)+1}</span>\r\n\t\t\t\t\t\t\t\t\t<a href="${list.productId}.html" class="pic" dd_name="排行榜商品图片${parseInt(index)+1}" target="_blank" style="display:none">\r\n\t\t\t\t\t\t\t\t\t\t<img id="largePic" src="${list.productImage}" title="${list.productName}&nbsp;${list.subName}">\r\n\t\t\t\t\t\t\t\t\t</a>\r\n\t\t\t\t\t\t\t\t\t<p class="name" dd_name="排行榜商品名称${parseInt(index)+1}">\r\n\t\t\t\t\t\t            \t<a href="${list.productId}.html" title="${list.productName}&nbsp;${list.subName}" target="_blank">${list.productName}</a>\r\n\t\t\t\t\t\t        \t</p>\r\n\t\t\t\t\t\t            <p class="zuozhe" style="display:none">${list.authorName}</p>\r\n\t\t\t\t\t\t            <p class="price" style="display:none">\r\n\t\t\t\t\t\t            \t<span class="price_d">${list.price}</span>\r\n\t\t\t\t\t\t            \t<span class="price_zhe">${list.discount}</span>\r\n\t\t\t\t\t\t            </p>\r\n\t\t\t\t\t\t\t\t</li>\r\n\t\t\t\t\t\t\t\t{@/each}',
a.data[f]),d="","hotBang"==f&&(d="018"),"newBang"==f&&(d="019"),$("#"+f+"_data").attr("ddt-area",d),$("#"+f+"_data").html(b));k.find("li").mouseover(function(){$(this).addClass("hover").find(".pic,.zuozhe,.price").each(function(){$(this).show()});$(this).siblings().removeClass("hover").find(".pic,.zuozhe,.price").each(function(){$(this).hide()})});k.find("li:eq(0)").mouseover();c.find("li:eq(0)").mouseover()}})}return{init:function(){if("publish"!=g().template)return!1;h();$("#bang_div").ddlazyload({func:l})}}}(jQuery);
!window.jQuery&&document.write("<script src='http://product.dangdang.com/js/jquery.js'>\x3c/script>");!window.prodDDutil&&document.write("<script src='http://product.dangdang.com/js/ddutil.js'>\x3c/script>");!window.prodDCutil&&document.write("<script src='http://product.dangdang.com/js/dcutil.js'>\x3c/script>");
var productsList=function(){function p(){var b={};b.product=[{productId:$(".info:eq(0)").data("select-id"),productCount:$(".info:eq(0)").data("number"),promotion:[]}];$(".info:gt(0)").each(function(c,f){b.product[0].promotion.push({promotionId:$(f).data("promo-id"),gift:[{giftId:$(f).data("select-id"),giftCount:$(f).data("number")}]})});var c=prodDCutil.getSourceUrl();b.referer=c._url;b.prev_referer=c._referrer;return encodeURIComponent(prodDDutil.encodeJson(b))}function t(b){var c={product:[]};$(".info").each(function(a,
d){var e={productId:$(d).data("select-id"),productCount:$(d).data("number"),promotion:[{promotionId:b}]};c.product.push(e)});var a=prodDCutil.getSourceUrl();c.referer=a._url;c.prev_referer=a._referrer;return encodeURIComponent(prodDDutil.encodeJson(c))}function n(){var b={product:[]};$(".info").each(function(c,a){var d={productId:$(a).data("select-id"),productCount:$(a).data("number")};b.product.push(d)});var c=prodDCutil.getSourceUrl();b.referer=c._url;b.prev_referer=c._referrer;return encodeURIComponent(prodDDutil.encodeJson(b))}
function d(){var b={product_ids:$(".info:eq(0)").data("select-id")+"."+$(".info:eq(0)").data("number"),gift_id:"",exchange_id:"",exchange_price:"",addmoney_id:"",addmoney_price:"",referer:"",prev_referer:""};$(".info:gt(0)").each(function(c,a){28==$(a).data("promo-type")?(b.exchange_id=$.trim($(a).data("select-id")),b.exchange_price=$.trim($(a).find("span[name='price']").data("price"))):3==$(a).data("promo-type")?b.gift_id=$.trim($(a).data("select-id")):229==$(a).data("promo-type")&&(b.addmoney_id=
$.trim($(a).data("select-id")),b.addmoney_price=$.trim($(a).find("span[name='price']").data("price")))});var c=prodDCutil.getSourceUrl();b.referer=c._url;b.prev_referer=c._referrer;return $.param(b)}function e(){$("#masks,#partner_pop").remove();$("body").css({overflow:"scroll"})}var h={},a="",k={},g="",l={},m={};return{productDomain:"product.dangdang.com",getProducts:function(b){h=$.extend({},b.vipInfoObj);a=b.moduleType;k=b.promotion;g=b.buttonType;var c="",d;for(d in b.product)if(b.product.hasOwnProperty(d)){var e=
b.product[d],c=c+(e.productId+",");l["p"+e.productId]=e}c=c.substr(0,c.length-1);$.ajax({type:"GET",url:"//product.dangdang.com?r=callback/get-products",data:{productIds:c},dataType:"jsonp",jsonp:"callback",beforeSend:function(){$("#products-list").html('<div style="position:fixed;top:0;left:0;width:100%;height:100%;z-index:10000;_position:absolute;_top:expression(eval(document.documentElement.scrollTop));_height:expression(eval(document.documentElement.clientHeight));background-color:#000;filter:alpha(opacity=20);opacity:0.2;">\r\n\t\t\t\t\t <iframe style="border:none;height:100%;width:100%;opacity=0;filter:alpha(opacity=0);"></iframe></div>\r\n\t\t\t\t\t <div style="position:fixed;left:50%;top:50%;margin-top:-196px;margin-left:-483px;z-index:10001;width:960px;height:400px;background-color:#fff;border:1px solid #ccc;text-align:center;"><p style="height:400px;line-height:400px"><img src="//product.dangdang.com/images/loading2.gif" style="vertical-align:middle">&nbsp;内容加载中，请稍候。。。</p></div>')},
jsonpCallback:"productsList.callbackFunc"})},callbackFunc:function(b){if(""!=b.errMsg)return!1;m={};for(var c in b.data)m[c]=$.extend(b.data[c],l[c]);b=document.getElementsByTagName("head")[0];c=document.createElement("link");c.href="//product.dangdang.com/css/partnerPop.min.css";c.rel="stylesheet";c.type="text/css";b.appendChild(c);$("body").css({overflow:"hidden"});this.showHtml();this.showTotal()},showHtml:function(){var b=m,c;c="";switch(a){case 225:c="优惠套餐中包含以下商品，请选择商品属性";break;case 2:c="拍档组合中包含以下商品，请选择商品属性";
break;case 3:c="赠送以下赠品，请选择商品属性";break;case 28:c="换购以下商品，请选择商品属性"}var d,f='<a href="javascript:void(0)" class="btn btn_red" dd_name="加入购物车" id="pop_addcart"><i class="cart"></i>加入购物车</a>';switch(g){case "2":f='<a href="javascript:void(0)" class="btn btn_b btn_b_red" dd_name="立即购买" id="pop_addcart">立即购买</a>';break;case "3":f='<a href="javascript:void(0)" class="btn btn_green" dd_name="预订" id="pop_addcart"><i class="cart"></i>预订</a>'}d=f;f=[];f.push('<div class="masks" id="masks"><iframe style="border:none;height:100%;width:100%;opacity=0;filter:alpha(opacity=0);"></iframe></div>');
f.push('<div class="partner_pop" id="partner_pop"><h3><span class="hint">'+c+'</span><a href="javascript:void(0)" class="close" id="close_pop"></a></h3>');f.push('<div class="partner_list"><div class="clearfix partner_list_box">');f.push("</div></div>");f.push('<div class="partner_buy">');f.push(d);if(225==a){f.push('<span class="price" id="T_buyPrice">套餐价：<b>&yen;'+k.promoPrice+"</b></span>");c=0;for(var l in b)c+=b[l].productCount;f.push('<span class="jian"><b id="T_buyBum">'+c+"</b>件商品</span>")}else f.push('<span class="price" id="T_buyPrice">总价：<b></b></span>'),
f.push('<span class="jian"><b id="T_buyBum"></b>件商品</span>');f.push("</div></div>");c=$(f.join(""));c.on("click","#close_pop",e).on("click","#pop_addcart",{promotionObj:k,moduleType:a},productsList.addCart);$("#products-list").html(c);f=0;for(l in b)f++,c=product.getHtml(b[l],k,a,h),$(".partner_list_box").append(c),0==f%2&&$(".partner_list_box").append('<div class="clear"></div>')},showTotal:function(){if(225==a)return!1;var b=0,c=0;$(".info").each(function(a,d){""!=$(d).data("select-id")&&(b+=~~$(d).data("number"),
c+=parseFloat($(d).find("span[name='price']").data("price"))*~~$(d).data("number"))});$("#T_buyBum").text(b);$("#T_buyPrice b").html("&yen;"+c.toFixed(2))},addCart:function(b){var c=!0;$(".info").each(function(b,a){if($(this).hasClass("info_hover"))return c=!1;if(""==$(this).data("select-id"))return c=!1,$(this).addClass("info_hover"),!1});if(c)if(1==g||3==g){var a="";3==b.data.moduleType||28==b.data.moduleType?a=p():225==b.data.moduleType?a=t(b.data.promotionObj.promoId):2==b.data.moduleType&&(a=
n());location.href="//shopping.dangdang.com/shoppingcart/cart_append_new?product_ids="+a}else 2==g&&(location.href="//checkoutb.dangdang.com/checkout.aspx?checkout_type=10&"+d())}}}(),product=function(){function p(d,e,h,a){var k=function(){var a=0,d;for(d in e.colorSize)e.colorSize.hasOwnProperty(d)&&a++;return a}();if(1==k)for(var g in e.skuInfo)e.skuInfo.hasOwnProperty(g)&&0==e.skuInfo[g].stockStatus.stockStatus&&d.find("a[data-value='"+e.skuInfo[g][h]+"']").addClass("disabled").removeClass("chosen");
else 2==k&&d.find("ul").each(function(){if($(this).data("type")==h)return!0;var d=$(this).data("type");$(this).find("a").each(function(){$(this).removeClass("disabled");var g=$(this).data("value"),b=!1,c;for(c in e.skuInfo)if(e.skuInfo.hasOwnProperty(c)){var k=e.skuInfo[c];k[h]==a&&k[d]==g&&(b=!0,"0"==k.stockStatus.stockStatus&&$(this).addClass("disabled").removeClass("chosen"))}b||$(this).addClass("disabled").removeClass("chosen")})})}function t(d){var e=[],h;for(h in d)d[h].haveStock="0"!=d[h].stockStatus.stockStatus,
d[h].id=h.substr(1),e.push(d[h]);e.sort(function(){return function(a,d){var e=-1;return e=a.haveStock^d.haveStock?a.haveStock?-1:1:a.price.salePrice==d.price.salePrice?a.id-d.id:a.price.salePrice-d.price.salePrice}}());return e[0].id}function n(d,e){var h=e.salePrice;"undefined"!=typeof d&&0<d.userType&&("vipPrice"in e&&1===~~e.isVipDiscount&&(h=e.vipPrice["p"+d.userType]),1===~~e.isShopVip&&"shopVip"in d.userShopType&&(h=e.salePrice*d.userShopType.discount));return h}return{getHtml:function(d,e,
h,a){var k=d.colorSize;"undefined"==typeof a||jQuery.isEmptyObject(a)||this.handlePrice(a);a=[];var g="",l="",m="",b="",c="",p="",f="",n="",q="";if("0"==d.isCatalog){g="//"+productsList.productDomain+"/"+d.productId+".html";l=d.skuInfo.image;m=d.skuInfo.title;q=d.promotion;if("1"==d.isLocal||"225"==h||"2"==h)c="&yen;"+d.skuInfo.price.salePrice,b=d.skuInfo.price.salePrice;else if("undefined"!=typeof q){if("3"==q.promoType)c="",b="0";else if("28"==q.promoType||"229"==q.promoType)c="+&yen;"+q.promoPrice,
b=q.promoPrice;f=q.promoId;n=q.promoType}p=d.skuInfo.productId}a.push('<div class="info" data-select-id="'+p+'" data-number="'+d.productCount+'" data-promo-id="'+f+'" data-promo-type="'+n+'">');a.push('<div class="pic"><a href="'+g+'" target="_blank"><img src="'+l+'" title="'+m+'"></a><span name="price" data-price="'+b+'">'+c+"</span></div>");a.push('<div class="cuxiao_info choose_xilie clearfix">');a.push('<div class="only_title"><a href="'+g+'" target="_blank" title="'+m+'">'+m+"</a></div>");a.push('<div class="clearfix">');
if("object"==typeof k)for(var r in k)if(k.hasOwnProperty(r)){a.push('<div class="left letter02">'+k[r].name+"</div>");a.push('<div class="right"><div class="clearfix">');g=k[r].list;l=g.length;m="jia_gou_e";1==l&&(m+=" chosen");if("undefined"!=typeof g["0"].image)for(a.push('<ul class="list_c" data-type="'+r+'"><li>'),b=0;b<l;b++)a.push('<a href="javascript:void(0)" class="'+m+'" title="'+g[b].value+'" data-value="'+g[b].value+'"><img src="'+g[b].image+'"><i></i></a>');else for(a.push('<ul class="list_r" data-type="'+
r+'"><li>'),b=0;b<l;b++)a.push('<a href="javascript:void(0)" class="'+m+'" title="'+g[b].value+'" data-value="'+g[b].value+'">'+g[b].value+"</a>");a.push("</li></ul>");a.push("</div></div>")}"1"==d.isLocal&&(a.push('<div class="left letter02">数量</div>'),a.push('<div class="right"><div class="num"><input id="buy_number" class="text" value="'+d.productCount+'" type="text" readonly><a href="javascript:void(0)" class="num_add num_disabled" dd_name="数量加"></a><a href="javascript:void(0)" class="num_del num_disabled" dd_name="数量减"></a></div></div>'));
a.push('<div class="hint">请选择您要的商品信息</div></div>');a=$(a.join(""));if("1"==d.isCatalog)for(r in a.find("a.jia_gou_e").bind("click",{obj:d,promotionObj:e,moduleType:h},product.selectEvent),e=d.selectProductId?d.selectProductId:t(d.skuInfo),d=d.skuInfo["p"+e],k)a.find("a[data-value='"+d[r]+"']").trigger("click");return a},selectEvent:function(d){var e=d.data.obj;d=d.data.moduleType;var h=$(this).parents(".info"),a=0,k;for(k in e.colorSize)e.colorSize.hasOwnProperty(k)&&a++;if(1==a&&$(this).hasClass("disabled"))return!1;
h.removeClass("info_hover");$(this).attr("class","jia_gou_e chosen").siblings().removeClass("chosen");k={};var g=$(this).data("value"),a=$(this).parents("ul").data("type");k[a]=g;p(h,e,a,g);var g=!0,l;for(l in e.colorSize)if(e.colorSize.hasOwnProperty(l)&&l!=a){var m=h.find("ul[data-type='"+l+"']").find("a.chosen");1==m.length?k[l]=m.data("value"):g=!1}l={};if(g){for(var b in e.skuInfo)if(e.skuInfo.hasOwnProperty(b)){var a=!0,c;for(c in k)if(k.hasOwnProperty(c)&&e.skuInfo[b][c]!=k[c]){a=!1;break}if(1==
a){l=e.skuInfo[b];break}}b="//"+productsList.productDomain+"/"+l.productId+".html";c=l.title;k=l.image;var n=m=g=a="",f=e.promotion;if("1"==e.isLocal||"225"==d||"2"==d)g="&yen;"+l.price.salePrice,a=l.price.salePrice;else if("undefined"!=typeof f){if("3"==f.promoType)g="",a="0";else if("28"==f.promoType||"229"==f.promoType)g="+&yen;"+f.promoPrice,a=f.promoPrice;m=f.promoId;n=f.promoType}h.data("select-id",l.productId).data("promo-id",m).data("promo-type",n);h.find(".pic").find("span[name='price']").html(g).data("price",
a).end().find("a").attr("href",b).find("img").attr("src",k).attr("title",c);h.find(".only_title a").attr("href",b).attr("title",c).html(c)}else h.data("select-id","");productsList.showTotal()},handlePrice:function(d){var e=this.productObj;if(0==e.isCatalog)e.spuInfo.price.salePrice=n(d,e.spuInfo.price);else{var e=e.skuInfo.itemInfo,h;for(h in e)e[h].price.salePrice=n(d,e[h].price)}}}}();function showListsPop(p){if(jQuery.isEmptyObject(p))return!1;productsList.getProducts(p)};
var writeComment=(function(){var url={writeComment:"http://comment.dangdang.com/iframe/write",updateComment:"http://comment.dangdang.com/iframe/update"};var exports={};var layerComm;var defaults={tips:["超烂啊","不值一提","水准之下","水准之下","聊胜于无","聊胜于无","值得一看","值得一看","极力推荐","极力推荐"],score:0,content:"",startNum:10,maxContentLen:2000,minContentLen:5};var checkFormSubmit=false;var boxurl;var param={};function require(){return{productId:item.base.mainProductId,categoryPath:item.base.categoryPath,mediumId:item.base.mediumId,mainProductId:item.base.mainProductId,template:item.base.template,shopId:item.base.shopId,productMedium:item.base.mediumId}}function getCustComment(){var params=require();$.getJSON("/",{r:"comment/get-cust-comment",productId:params.productId,mainProductId:params.mainProductId},function(response){if(response.code==1){param.login=0;boxurl=choseLongOrShort(param);$("#w-comment").html("我要写评论")}else{param.longOrShort=response.data.status;param.commentId=response.data.content["commentId"];param.longCommentId=response.data.longcontent["commentId"];if(response.code==0){var _tmp_com=response.data.pageInfo["total_comment_num"];window.commentNum=_tmp_com;$("#comm_num_down").text();$("#comment_total_num_title").html(_tmp_com);$("#comm_num_down").html(_tmp_com);$("#comment_tab").html("商品评论("+_tmp_com+")");$("#comment_num_tab span:eq(0)").html("全部（"+_tmp_com+"）");if(response.data.content["last_change_date"]>response.data.longcontent["last_change_date"]){$("#w-comment").html("我对本书的评论："+response.data.content["score"]+"分")}else{$("#w-comment").html("我对本书的评论："+response.data.longcontent["score"]+"分")}param.shortWritedOrNot=response.data.content["commentId"]==0?0:1;param.longWritedOrNot=response.data.longcontent["commentId"]==0?0:1;if(param.shortWritedOrNot==1){$("#w-short-comment").html("已评过")}if(param.longWritedOrNot==1){$("#w-long-comment").html("已评过")}boxurl=choseLongOrShort(param,param.longOrShort,param.commentId,param.longCommentId,param.shortWritedOrNot,param.longWritedOrNot)}else{param.shortWritedOrNot=0;param.longWritedOrNot=0;boxurl=choseLongOrShort(param,param.longOrShort,param.commentId,param.longCommentId,param.shortWritedOrNot,param.longWritedOrNot);$("#w-comment").html("我要写评论")}}})}function showCustComment(){var params=require();$.getJSON("/",{r:"comment/get-cust-comment",productId:params.productId,mainProductId:params.mainProductId},function(response){if(response.code==1){showMsgBox("loginAction","","",function(){$("body").trigger("renderAfterLogin")})}else{var commentData=response.data.content;defaults.score=commentData["score"];defaults.content=commentData["content"];defaults.total_image_count=commentData["total_image_count"];var popCommentTpl='<div class="pop_pinglun comment">                <input type = "hidden" id="comment-flag" value="{@if commentId>0 || score>0}1{@else}0{@/if}"/>                <input type = "hidden" id="pop-comment-id" value="${commentId}"/>                <h3></h3>                <div class="tab_comment">                  <div class="two_btn">                  <a href="#" class="btn on">短评</a><a href="#" class="btn long_comment">长评</a>                  </div>                </div>                <p class="title">我对本书的评论是：</p>                <div class="star_pingfen clearfix">                    <span class="star_box" id="pop-comment-star" {@if score } data-score="${score}" {@else} data-score="10" {@/if} >                    </span><span id="pop-star-msg"></span><span class="hint">滑动星星评论</span>                </div>                <div class="comm_list">                    <div class="txt">                        <span class="placeholder" id="pop-content-placeholder" {@if content!=""} style="display: none"{@/if}>这本书的内容、作者、文笔...给你留下了怎样的印象？是否值得推荐给其他书友？写下你的书评吧~</span>                        <textarea id="pop-comment-content" name="">${content}</textarea>                        <span class="num">2000</span>                    </div>                    <div class="hint" style="display: none;" id="pop-comment-msg"></div>                    <div class="pic_add">                    <div class="pic_show">                    <ul>                    <li class="first"><input name="pic" id="pic" type="file" multiple="multiple"/> ></li>                    <li class="number">{@if total_image_count}${total_image_count}{@else}0{@/if}/5</li>                    </ul>                    </div>                    <div class="info_remind">精彩评论的银铃铛有机会额外<span>抵3角钱</span></div>                    </div>                    <div class="btn">                        {@if score == 0}                        <a href="javascript:;" class="other" id="pop-comment-btn">发表</a>                        {@else}                        <a href="javascript:;" id="pop-comment-btn">发表</a></div>                        {@/if}                    </div></div>';var popCommentHtml=juicer(popCommentTpl,commentData);layerComm=layer.open({type:1,content:popCommentHtml,closeBtn:1});var starSpan=[];for(var i=0;i<defaults.startNum;i++){starSpan.push('<a href="javascript:void(0)" style="width:'+(i+1)*10+"%;z-index:"+(defaults.startNum-i)+'"></a>')
}$("#pop-comment-star").html(starSpan.join(""));$("#pop-comment-content").next("span.num").html(defaults.maxContentLen-$("#pop-comment-content").val().length);if($("#comment-flag").val()==1){$("#pop-comment-btn").html("修改")}showStar(9,10);$("#pop-comment-btn").removeClass("other");if(response.code==0&&commentData.score>0){var score=commentData.score;var index=parseInt(score)-1;showStar(index,score)}$("#pop-content-placeholder").on("click",function(){$(this).hide();$("#pop-comment-content").focus()});$("#pop-comment-content").on("focus",function(){$("#pop-content-placeholder").hide();$("#pop-comment-msg").hide()}).on("blur",function(){if($(this).val()==""){$("#pop-content-placeholder").show()}}).on("keyup",function(){var obj=$(this);var count=obj.val().length;if(count>defaults.maxContentLen){obj.val(obj.val().substr(0,defaults.maxContentLen));count=defaults.maxContentLen}if(count==0){$("#pop-content-placeholder").show()}else{$("#pop-content-placeholder").hide()}$(this).next(".num").html(defaults.maxContentLen-count)});$("#pop-comment-star").find("a").each(function(index,element){$(this).click(function(){var star_index=index;var score=parseInt(star_index)+1;$("#pop-comment-star").data("score",score);showStar(star_index,score);if(score>0){$("#pop-comment-btn").removeClass("other")}});$(this).mouseenter(function(){var star_index=index;var score=parseInt(star_index)+1;showStar(star_index,score)});$(this).mouseleave(function(){var score=$("#pop-comment-star").data("score");if(score==0){score=10}$("#pop-comment-star").data("score",score);var star_index=parseInt(score)-1;showStar(star_index,score);if(score>0){$("#pop-comment-btn").removeClass("other")}})});if($("#comment-flag").val()==1){$("#pic").attr("disabled","disabled")}$("#pop-comment-btn").click(function(){if(checkFormSubmit==true){return false}if($(this).hasClass("other")){return false}var check=submitCheck();if(!check){return}var comment_flag=$("#comment-flag").val();if(comment_flag==1){updateComment()}else{writeComment()}})}})}function deleteimg(){$(document).on("click",".del",function(){var imgname=$(this).data("img");$(this).parent().remove();var length=$(".pic_show >ul >li").length-2;$(".pic_show >ul >li:last-child").html(length+"/5")})}function uploadimg(){$(document).on("change","#pic",function(){var length=$(".pic_show >ul >li").length-2;if(length==5){return false}var sort=length.length-1;var data=new FormData();data.append("img",$("#pic")[0].files[0]);data.append("productid",require().productId);data.append("sort",sort);var picset=["image/jpeg","image/png"];var picg=$("#pic")[0].files[0]["type"];if($.inArray(picg,picset)=="-1"){var popHtml='<div class="pop_pinglun"><h3></h3>';popHtml+='<div class="ok"><i class="icon"></i><span>请上传图片！</span></div>';popHtml+="</div>";layer.open({type:1,content:popHtml,closeBtn:1,isOutAnim:false});return false}$.ajax({url:window.localUrl+"?r=comment/uploadimg",type:"POST",data:data,processData:false,contentType:false,success:function(result){var str='<li><img src="'+result+'"><a href="javascripy:;" class="del" data-img = "'+result+'"></a></li>';$(".pic_show >ul>li:last-child").prev("li").after(str);var length=$(".pic_show >ul >li").length-2;$(".pic_show >ul >li:last-child").html(length+"/5")},error:function(XMLHttpRequest,textStatus,errorThrown){}})})}function showStar(star_index,score){$("#pop-comment-star").find("a:eq("+star_index+")").addClass("star").end().find("a:lt("+star_index+")").addClass("star").end().find("a:gt("+star_index+")").removeClass("star");var message=score+"分 "+defaults.tips[star_index];$("#pop-star-msg").text(message).next("span.hint").hide()}function submitCheck(){var new_score=$("#pop-comment-star").data("score");if(new_score<=0){$("#pop-comment-msg").html('<span class="icon"></span>请点击星星评论').show();return false}var new_content=$.trim($("#pop-comment-content").val());if(new_content.length<defaults.minContentLen){$("#pop-comment-msg").html('<span class="icon"></span>评论内容至少'+defaults.minContentLen+"个字，加油").show();return false}if(new_score==defaults.score&&new_content==defaults.content){layer.close(layerComm);return false}return true}function writeComment(){checkFormSubmit=true;var params=require();var new_score=$("#pop-comment-star").data("score");var new_content=$("#pop-comment-content").val();var img=[];$(".pic_show>ul>li>a").each(function(i){img.push($(this).data("img"))});$.ajax({url:window.localUrl+"?r=comment/write-comment-by-cust",type:"POST",data:{score:new_score,content:new_content,shopId:params.shopId,productId:params.productId,mainProductId:params.mainProductId,productCategory:params.categoryPath,productMedium:params.mediumId,images:img},dataType:"json",success:function(result){checkFormSubmit=false;if(result.code==2002){$("#pop-comment-msg").html('<span class="icon"></span>评论内容包含敏感词，不能成功发表').show()}else{layer.close(layerComm);var popHtml='<div class="pop_pinglun"><h3></h3>';if(result.code==0){window.commentCustNum=1;var _tmp_comment=parseInt($("#comment_total_num_title").text())+window.commentCustNum;
        $("#comment_total_num_title").html(_tmp_comment);$("#comm_num_down").html(parseInt($("#comm_num_down").text())+window.commentCustNum);$("#comment_tab").html("商品评论("+_tmp_comment+")");$("#comment_num_tab span:eq(0)").html("全部（"+_tmp_comment+"）");$("#w-comment").html("我对本书的评论："+new_score+"分");popHtml+='<div class="ok"><i class="icon"></i><span>已发表成功！</span></div>'}else{if(result.code==2001){popHtml+='<div class="ok worry01"><i class="icon"></i><span>您的账户已封禁，请联系客服</span></div>'}else{if(result.code==2003){popHtml+='<div class="ok worry02"><i class="icon"></i><span>不能重复提交评论哟~</span></div>'}else{popHtml+='<div class="ok worry02"><i class="icon"></i><span>发表失败！</span></div>'}}}popHtml+="</div>";layer.open({type:1,content:popHtml,closeBtn:1,isOutAnim:false})}}})}function updateComment(){checkFormSubmit=true;var new_score=$("#pop-comment-star").data("score");var new_content=$("#pop-comment-content").val();var comment_id=$("#pop-comment-id").val();$.ajax({url:window.localUrl+"?r=comment/update-comment-by-cust",type:"POST",data:{score:new_score,content:new_content,productId:require().productId,commentId:comment_id,productCategory:require().categoryPath,productMedium:require().productMedium},dataType:"json",success:function(result){checkFormSubmit=false;if(result.code==2002){$("#pop-comment-msg").html('<span class="icon"></span>评论内容包含敏感词，不能成功发表').show()}else{layer.close(layerComm);var popHtml='<div class="pop_pinglun"><h3></h3>';if(result.code==0){if(new_score!=defaults.score){$("#w-comment").html("我对本书的评论："+new_score+"分")}popHtml+='<div class="ok"><i class="icon"></i><span>已发表成功！</span></div>'}else{if(result.code==2001){popHtml+='<div class="ok worry01"><i class="icon"></i><span>您的账户已封禁，请联系客服</span></div>'}else{if(result.code==2003){popHtml+='<div class="ok worry02"><i class="icon"></i><span>不能重复提交评论哟~</span></div>'}else{popHtml+='<div class="ok worry02"><i class="icon"></i><span>发表失败！</span></div>'}}}popHtml+="</div>";layer.open({type:1,content:popHtml,closeBtn:1})}}})}function checkWrited(shortWritedOrNot,longWritedOrNot){if(longWritedOrNot=="1"||shortWritedOrNot=="1"){return url.updateComment}else{return url.writeComment}}function choseLongOrShort(param,longOrShort,commentId,longCommentId,shortWritedOrNot,longWritedOrNot){if(param.login==0){return"http://comment.dangdang.com/iframe/write/0/0_0/"+require().mainProductId+"_"+require().productId+"_"+require().shopId+"_"+require().categoryPath+"_"+require().productMedium}else{var firsturl=checkWrited(shortWritedOrNot,longWritedOrNot);var params=require();var param=commentId+"_"+longCommentId+"/"+params.mainProductId+"_"+params.productId+"_"+params.shopId+"_"+params.categoryPath+"_"+params.mediumId;return firsturl+"/"+longOrShort+"/"+param}}function getShort(){var boxurl=checkWrited(param.shortWritedOrNot);var params=require();var paramss=param.commentId+"_"+param.longCommentId+"/"+params.mainProductId+"_"+params.productId+"_"+params.shopId+"_"+params.categoryPath+"_"+params.mediumId;return boxurl+"/0/"+paramss}function getLong(){var boxurl=checkWrited(param.longWritedOrNot);var params=require();var paramss=param.commentId+"_"+param.longCommentId+"/"+params.mainProductId+"_"+params.productId+"_"+params.shopId+"_"+params.categoryPath+"_"+params.mediumId;return boxurl+"/1/"+paramss}exports.init=function(){getCustComment();$("#w-comment").off().click(function(){showMsgBox("","",boxurl,function(){$("body").trigger("renderAfterLogin");getCustComment()})});$(" #w-short-comment").click(function(){showMsgBox("","",getShort(),function(){$("body").trigger("renderAfterLogin")})});$("#w-long-comment").click(function(){showMsgBox("","",getLong(),function(){$("body").trigger("renderAfterLogin")})});$("body").on("showCommentScore",getCustComment)};return exports})();(function(d){d("body").on("loadSku",function(){var b=[prodOperation,prodBuyNumber,mainImg,Cookie,freight,geo,shop,price,promotion,coupon,online,bang,detail,writeComment],c=["recommend","comment","question","search"],a;prodDCutil.time.setServerTime(item.base.serverTimeClock);delete item.base.serverTimeClock;for(a=0;a<b.length;a++)void 0!=b[a]&&b[a].hasOwnProperty("init")&&b[a].init();for(a=0;a<c.length;a++)c[a]in window&&d("#"+c[a]).ddlazyload({func:window[c[a]].init})})})(jQuery);
$(function(){$("#show_user_msg").on("click",function(){showMsgBox("shop_collect_btn","","",function(){$("body").trigger("renderAfterLogin");$("#user-msg-pop").show()})});$("#user-msg-pop-close").on("click",function(){close()});$("#user-msg-pop").on("input propertychange","input[id='imputer']",function(){$(this).attr("class","a inputting");$("#user-msg-toast").hide()});$("#user-msg-submit").on("click",function(){var formData=getFormData();var checkFromData=checkFormData(formData);if(checkFromData){var isSuccess=saveFormData(formData);if(!isSuccess){alert("提交失败，请稍后再试！")}else{var inputData=$("#user-msg-form").find("input");$.each(inputData,function(i,data){$("input[name='"+data.name+"']").val("")});alert("提交成功！");close()}}else{$("#user-msg-toast").show()}});function saveFormData(formData){var shopId=$("#user-msg-shopId").val();var templateId=$("#user-msg-templateId").val();var pageId=$("#user-msg-productId").val();var data={};data["shopId"]=shopId;data["templateId"]=templateId;data["pageId"]=pageId;for(var n in formData){data[formData[n].name]=formData[n].value}var result=false;$.ajaxSettings.async=false;$.getJSON("/",{r:"comment/save-user-msg-info",data:JSON.stringify(data)},function(response){var code=response.errorCode;if(code===0){result=true}});return result}function close(){$("#user-msg-pop").hide()}function checkFormData(formData){var checkResult=true;var toastText=null;for(var data in formData){var must=formData[data].must;var value=formData[data].value;var namecn=formData[data].namecn;var name=formData[data].name;if(must==="1"){toastText=checkIsNotEmpty(value,namecn);if(toastText!=null){checkResult=false;break}}if(name==="name"){toastText=checkLength(value,10,namecn);if(toastText!=null){checkResult=false;break}toastText=checkIsChinese(name,namecn);if(toastText!=null){checkResult=false;break}}if(name==="tel"){toastText=checkPhoneNum(value);if(toastText!=null){checkResult=false;break}}if(name==="city"){toastText=checkLength(value,50,namecn);if(toastText!=null){checkResult=false;break}toastText=checkIsChinese(name,namecn);if(toastText!=null){checkResult=false;break}}if(name==="babyName"){toastText=checkLength(value,10,namecn);if(toastText!=null){checkResult=false;break}toastText=checkIsChinese(name,namecn);if(toastText!=null){checkResult=false;break}}if(name==="babyAge"){toastText=checkLength(value,2,namecn);if(toastText!=null){checkResult=false;break}toastText=checkIsNum(value,namecn);if(toastText!=null){checkResult=false;break}}if(name==="course"){toastText=checkLength(value,50,namecn);if(toastText!=null){checkResult=false;break}}}if(!checkResult&&toastText!=null){$("#user-msg-toast").text(toastText)}return checkResult}function checkIsNum(value,name){var ret=/^[0-9][0-9]{0,1}$/;if(ret.test(value)){return null}return name+"仅支持数字"}function checkPhoneNum(value){var pattern=/^1[34578]\d{9}$/;if(pattern.test(value)){return null}return"请您输入正确的手机号码"}function checkLength(value,maxLength,name){if(value.length<=maxLength){return null}return name+"仅支持输入"+maxLength+"个字符"}function checkIsChinese(value,name){var reg=/[\w\u4E00-\u9FA5]/;if(reg.test(value)){return null}return name+"仅支持输入汉字、大小写字母和数字"}function checkIsNotEmpty(value,name){if(value.trim()!==""){return null}return name+"不能为空"}function getFormData(){var formData=[];var inputData=$("#user-msg-form").find("input");$.each(inputData,function(i,data){var nameAndisMust=data.name.split(".");var form={};form["name"]=nameAndisMust[0];form["must"]=nameAndisMust[1];form["namecn"]=nameAndisMust[2];form["value"]=data.value;form["placeholder"]=data.placeholder;formData[i]=form});return formData}});